<!DOCTYPE html>
<html lang="en">
<head>
<link rel="manifest" href="manifest.json">
<meta charset="UTF-8">
<title>Vibe with Jishnu</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0f2e">¬†

<style>
    .trailer-link-box {

        display: block;

        width: 90%;

        max-width: 700px;

        margin: 10px auto;

        padding: 15px;

        text-align: center;

        background: linear-gradient(90deg, rgba(106, 91, 255, 0.2), rgba(184, 75, 255, 0.2));

        border: 1px solid #6a5bff;

        border-radius: 12px;

        text-decoration: none;

        transition: all 0.3s ease;

        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);

    }

    .trailer-link-box:hover {

        background: linear-gradient(90deg, rgba(106, 91, 255, 0.4), rgba(184, 75, 255, 0.4));

        transform: translateY(-3px);

        box-shadow: 0 0 20px rgba(106, 91, 255, 0.5);

    }

    .trailer-text {

        color: #ffffff;

        font-weight: bold;

        letter-spacing: 2px;

        font-size: 16px;

        text-transform: uppercase;

    }

    .trailer-text span {

        color: #00ffbf; /* Accent color */

        margin-right: 8px;

    }

    

/* ADD THIS NEW BLOCK INSIDE THE <style> TAG */

/* New badge for the playlist container itself */
.playlistContainer.new-release {
    border-color: #38ff38 !important; /* Bright green border */
}
.playlistContainer.new-release .playlistHeader {
    position: relative;
}

/* Style for the "NEW!!" badge */
.playlistContainer.new-release .new-badge {
    position: absolute;
    top: -10px;
    right: -10px;
    background: #38ff38; /* Bright green background */
    color: #0a0f2e;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 10px;
    font-weight: bold;
    letter-spacing: 0.5px;
    transform: rotate(5deg);
    box-shadow: 0 2px 5px rgba(0,0,0,0.4);
}

/* Styling for the playable tracks */
.track.playable-new strong {
    color: #00ffbf; /* Flute Anthem's color for emphasis */
}

/* END OF NEW CSS BLOCK */

  /* ADD THIS NEW BLOCK INSIDE THE <style> TAG */

.trailer-banner {
    width: 90%;
    max-width: 700px;
    margin: 0px auto 10px auto; /* Adds margin below the header and above the playlists */
    border-radius: 12px;
    overflow: hidden;
    position: relative;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    background: #1a0842; /* Fallback background */
}

.trailer-banner img {
    width: 100%;
    height: auto;
    display: block;
    filter: brightness(0.7); /* Slightly darken image so text stands out */
}
/* --- UPDATED COUNTDOWN BLOCK --- */

        #countdown-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            width: 90%;
            max-width: 700px;
            padding: 30px 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .countdown-title {
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 4px;
            color: #00d4ff;
            margin-bottom: 15px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        #countdown {
            font-size: clamp(2rem, 8vw, 3.5rem); 
            font-weight: 800;
            font-family: 'Courier New', Courier, monospace;
            letter-spacing: 2px;
            line-height: 1;
        }

        .label-container {
            display: flex;
            justify-content: center;
            width: 100%;
            max-width: 400px;
            margin-top: 10px;
            opacity: 0.6;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .label-container span {
            flex: 1;
            text-align: center;
        }

.banner-caption {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    padding: 15px 20px;
    background: linear-gradient(to top, rgba(10, 15, 46, 0.9), rgba(10, 15, 46, 0));
    color: white;
    font-size: 18px;
    font-weight: bold;
    text-align: center;
    letter-spacing: 1px;
}
.banner-caption span {
    color: #38ff38; /* Uses the "NEW!!" green for the highlight */
}

/* END OF NEW CSS BLOCK */
  
/* PAGE THEME */
body {
margin: 0;
background: #0a0f2e;
color: white;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
overflow-x: hidden;
position: relative;
min-height: 100vh;
}

/* --- THE BEATING HEART BACKGROUND --- */
#bass-bg {
position: fixed;
top: 50%;
left: 50%;
width: 80vw;
height: 80vw;
max-height: 80vh;
max-width: 80vh;
transform: translate(-50%, -50%);
background: radial-gradient(circle, var(--song-color, #6a5bff) 0%, rgba(0,0,0,0) 70%);
opacity: 0;
z-index: -1;
pointer-events: none;
border-radius: 50%;
transition: background 0.5s ease;
}

/* Pulse Animation */
.pulsing #bass-bg {
animation: heartbeat 0.6s cubic-bezier(0.1, 0.7, 1.0, 0.1) infinite;
}

@keyframes heartbeat {
0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.1; }
10% { transform: translate(-50%, -50%) scale(1.5); opacity: 0.6; }
100% { transform: translate(-50%, -50%) scale(1.6); opacity: 0; }
}

/* HEADER */
header {
display: flex;
align-items: center;
gap: 15px;
padding: 20px;
background: rgba(30, 0, 70, 0.8);
backdrop-filter: blur(8px);
border-bottom: 2px solid #6a5bff;
position: sticky;
top: 0;
z-index: 10;
}
header img { height: 50px; }
header h1 {
font-size: 28px;
font-weight: 800;
background: linear-gradient(90deg, #6a5bff, #b84bff);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
margin: 0;
letter-spacing: 1px;
}

/* CONTENT PADDING */
/* Padded to accommodate the fixed player bar at the bottom */
/* Update this block in your <style> tag */
.content { 
    padding-top: 20px; 
    padding-bottom: 250px; /* Increased this to push content above the player */
}

/* PLAYLIST BOX */
.playlistContainer {
width: 90%;
max-width: 700px;
margin: 20px auto;
background: rgba(255,255,255,0.03);
border-radius: 12px;
border: 1px solid rgba(255, 255, 255, 0.1);
padding: 15px;
transition: all 0.3s ease;
cursor: pointer;
}
.playlistContainer:hover {
background: rgba(255,255,255,0.07);
border-color: #6a5bff;
}

.playlistHeader { display: flex; align-items: center; gap: 15px; }
.playlistHeader img {
width: 70px; height: 70px; object-fit: cover;
border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}
.playlistTitle { font-size: 20px; font-weight: bold; }

/* SONG LIST */
.songList { display: none; margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; }
.track {
display: flex; justify-content: space-between; align-items: center;
padding: 12px; border-radius: 6px; margin-bottom: 5px;
cursor: pointer; transition: background 0.2s;
}
.track:hover { background: rgba(255,255,255,0.1); }
.track strong { font-size: 14px; }
.track span { font-size: 12px; opacity: 0.7; }

/* PLAYER BAR - MODIFIED */
.player {
position: fixed;
bottom: 0; left: 0; width: 100%;
background: rgba(10, 5, 30, 0.95);
backdrop-filter: blur(10px);
/* Padding adjusted to move content up */
padding: 10px 0 50px 0; 
display: flex; flex-direction: column;
justify-content: center; align-items: center;
border-top: 2px solid #6a5bff;
transition: border-color 0.5s ease;
z-index: 100;
box-shadow: 0 -10px 30px rgba(0,0,0,0.5);
}

/* Added a small bar at the bottom for visual effect/spacer */
.player::after {
content: "";
position: absolute;
bottom: 0;
left: 0;
width: 100%;
height: 40px; /* This creates the bar space */
background: rgba(10, 5, 30, 1);
z-index: 1;
}

.controls-row {
display: flex; justify-content: center; align-items: center; gap: 30px;
margin-bottom: 10px;
z-index: 2; /* Bring controls above the bottom bar */
}

button.control {
width: 55px; height: 55px; border-radius: 50%; border: none;
background: linear-gradient(135deg, #6a5bff, #b84bff);
color: white; font-size: 20px; cursor: pointer;
transition: transform 0.2s, box-shadow 0.2s;
display: flex; justify-content: center; align-items: center;
box-shadow: 0 4px 15px rgba(106, 91, 255, 0.4);
z-index: 2;
}
button.control:active { transform: scale(0.95); }
button.control:hover { transform: scale(1.1); box-shadow: 0 6px 20px rgba(106, 91, 255, 0.6); }

/* SEEK BAR / SLIDER */
.seek-container {
width: 80%;
max-width: 600px;
display: none;
align-items: center;
gap: 10px;
font-size: 12px;
color: rgba(255,255,255,0.7);
animation: fadeIn 0.5s ease;
margin-bottom: 10px; /* Adjusted spacing */
z-index: 2;
}

@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

input[type="range"] {
-webkit-appearance: none;
width: 100%; height: 4px;
background: rgba(255,255,255,0.2);
border-radius: 2px; outline: none; cursor: pointer;
}
input[type="range"]::-webkit-slider-thumb {
-webkit-appearance: none; width: 14px; height: 14px;
background: var(--song-color, #6a5bff);
border-radius: 50%; cursor: pointer;
box-shadow: 0 0 10px var(--song-color, #6a5bff);
transition: transform 0.1s;
}
input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.3); }

/* POPUP */
#popup {
/* Moved up to clear the new player bar padding */
position: fixed; bottom: 150px; right: 20px; width: 220px;
background: rgba(15, 10, 40, 0.9);
padding: 15px; border-radius: 12px;
border: 1px solid rgba(255,255,255,0.1);
display: none; z-index: 90;
backdrop-filter: blur(10px);
box-shadow: 0 8px 30px rgba(0,0,0,0.6);
animation: slideUp 0.3s ease-out;
}
@keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
#popup img { width: 100%; border-radius: 8px; margin-bottom: 10px; }

/* CLOSE BUTTON STYLE */
#closePopupBtn {
position: absolute;
top: 5px;
right: 8px;
background: none;
border: none;
color: rgba(255, 255, 255, 0.6);
font-size: 22px;
font-weight: bold;
cursor: pointer;
z-index: 100;
padding: 0;
line-height: 1;
transition: color 0.2s;
}
#closePopupBtn:hover {
color: #ff4d6d;
}

/* SCROLLING TITLE */
#popupSongName {
white-space: nowrap; overflow: hidden; width: 100%;
font-size: 14px; text-align: center; margin-bottom: 10px;
color: #fff; font-weight: 600;
}
#popupSongName span { display: inline-block; padding-left: 100%; animation: scrollText 8s linear infinite; }
@keyframes scrollText { 0% { transform: translateX(0%); } 100% { transform: translateX(-100%); } }

/* SOUNDWAVE */
.soundwave { display: flex; justify-content: center; gap: 4px; height: 15px; align-items: flex-end; }
.soundwave div { width: 3px; background: #6a5bff; animation: wave 0.8s infinite ease-in-out; }
.soundwave div:nth-child(2) { animation-delay: 0.1s; }
.soundwave div:nth-child(3) { animation-delay: 0.2s; }
.soundwave div:nth-child(4) { animation-delay: 0.3s; }
.soundwave div:nth-child(5) { animation-delay: 0.4s; }
@keyframes wave { 0%, 100% { height: 3px; } 50% { height: 15px; } }
.paused div { animation-play-state: paused; height: 3px; }

/* TRENDING SECTION STYLES - MODIFIED FOR HORIZONTAL SCROLL */
.trendingSection {
width: 90%;
max-width: 700px;
margin: 40px auto 20px auto;
padding: 15px 0; /* Adjusted padding for internal spacing */
border-radius: 12px;
background: rgba(255,255,255,0.03);
border: 1px solid rgba(255, 255, 255, 0.1);
}
.trendingSection h2 {
font-size: 24px;
border-bottom: 2px solid #b84bff;
padding: 0 15px 5px 15px; /* Added horizontal padding to title */
margin-top: 0;
color: #b84bff;
}
.trendingList {
list-style: none;
padding: 10px 15px;
margin: 0;
display: flex; /* Key for horizontal layout */
overflow-x: auto; /* Enable horizontal scrolling */
gap: 15px;
}
/* Style for horizontal scrollbar (optional, may vary by browser) */
.trendingList::-webkit-scrollbar { height: 6px; }
.trendingList::-webkit-scrollbar-thumb { background: rgba(106, 91, 255, 0.4); border-radius: 3px; }
.trendingList::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }

.trendingItem {
/* Set item width for visibility in horizontal scroll */
flex: 0 0 150px; 
display: flex;
flex-direction: column;
align-items: flex-start;
padding: 10px;
border-radius: 8px;
transition: background 0.2s, transform 0.2s;
cursor: pointer;
}
.trendingItem:hover { 
background: rgba(255,255,255,0.07); 
transform: translateY(-2px);
}
.trendingRank {
font-size: 14px;
font-weight: bold;
color: #6a5bff;
margin-bottom: 5px;
}
.trendingCover {
width: 100%;
height: 150px;
border-radius: 6px;
object-fit: cover;
margin-bottom: 8px;
box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}
.trendingInfo {
flex-grow: 1;
width: 100%;
}
.trendingTitle {
font-size: 14px;
font-weight: bold;
white-space: nowrap;
overflow: hidden;
text-overflow: ellipsis;
}
.trendingViews {
font-size: 11px;
opacity: 0.7;
margin-top: 3px;
}

</style>
</head>
<body class="">
    

<div id="bass-bg"></div>

<header>
<img src="logo.png" alt="Logo" onerror="this.style.display='none'">
<h1>Vibe with Jishnu</h1>
</header>

<div class="trailer-banner">
    <img src="tp.jpg" alt="LOT-III Trailer">
    <div class="banner-caption">
        <span>LOT-III Full Movie out now!!</span>
    </div>
</div>
    
<a href="https://drive.google.com/file/d/1sl3XzH4e5rl8wIvRxTHvxDzpU0vTlZPv/view?usp=drivesdk" target="_blank" class="trailer-link-box">

    <div class="trailer-text"><span>‚ñ∂</span> LOT-III OFFICIAL TRAILER</div>
</a>

<a href="https://youtu.be/Td1VHqZAfoU" target="_blank" class="trailer-link-box">

    <div class="trailer-text"><span>‚ñ∂</span> LOT-III FULL MOVIE</div>

</a>
<div id="countdown-container">
    <div class="countdown-title">LOT-III Release In</div>
    <div id="countdown">00:00:00:00</div>
    <div class="label-container">
        <span>Days</span>
        <span>Hrs</span>
        <span>Min</span>
        <span>Sec</span>
    </div>
</div>


<div class="playlistContainer new-release">
    <div class="playlistHeader" onclick="toggleList('list1')">
        <span class="new-badge">NEW!!</span>
        <img src="Poster.jpg" alt="LOT-III" onerror="this.src='https://via.placeholder.com/80/6a5bff/fff?text=Music'">
        <div>
            <div class="playlistTitle">LOT-III OST</div>
            <div style="font-size:12px; opacity:0.6">Original Sound Track</div>
        </div>
    </div>
    <div id="list1" class="songList"></div>
</div>

<div class="playlistContainer new-release">
    <div class="playlistHeader" onclick="toggleList('list4')">
	<span class="new-badge">NEW!!</span>
        <img src="Poster.jpg" alt="LOT-III Singles" onerror="this.src='https://via.placeholder.com/80/6a5bff/fff?text=Music'">
        <div>
            <div class="playlistTitle">LOT-III Singles</div>
            <div style="font-size:12px; opacity:0.6">Latest Releases</div>
        </div>
    </div>
    <div id="list4" class="songList"></div>
</div>

<div class="playlistContainer">
    <div class="playlistHeader" onclick="toggleList('list2')">
        <img src="Poster2.jpeg" alt="50 Shades" onerror="this.src='https://via.placeholder.com/80/6a5bff/fff?text=Music'">
        <div>
            <div class="playlistTitle">50 Shades of Jishnu Anthem</div>
            <div style="font-size:12px; opacity:0.6">Song of the century</div>
        </div>
    </div>
    <div id="list2" class="songList"></div>
</div>

<div class="playlistContainer">
    <div class="playlistHeader" onclick="toggleList('list3')">
        <img src="Poster3.jpeg" alt="Hits" onerror="this.src='https://via.placeholder.com/80/6a5bff/fff?text=Music'">
        <div>
            <div class="playlistTitle">Blockbuster Hits</div>
            <div style="font-size:12px; opacity:0.6">Fan Favorites</div>
        </div>
    </div>
    <div id="list3" class="songList"></div>
</div>

<div class="trendingSection">
<h2>Trending Songs üî•</h2>
<ul class="trendingList" id="trendingList">
</ul>
</div>


<div id="popup">
<button id="closePopupBtn" onclick="closePopup()">√ó</button>

<img id="popupImg" src="" onerror="this.style.display='none'">
<div id="popupSongName"></div>
<div class="soundwave" id="soundwave">
<div></div><div></div><div></div><div></div><div></div>
</div>
</div>
<br><br><br><br><br><br><br><br><br><br>
<div class="player">
<div class="controls-row">
<button class="control" onclick="prevSong()">‚èÆ</button>
<button class="control" onclick="togglePlay()">
<span id="playPauseIcon" style="margin-left:2px;">‚ñ∂</span>
</button>
<button class="control" onclick="nextSong()">‚è≠</button>
</div>

<div class="seek-container" id="seekContainer">
<span id="currTimeText">0:00</span>
<input type="range" id="seekSlider" min="0" max="100" value="0">
<span id="durTimeText">0:00</span>
</div>
</div>

<audio id="audio"></audio>

<script type="module">
    function updateCountdown() {
        const now = new Date();
        
        // --- TEST SETTINGS ---
        // Change 'testBirthday' to true to see the birthday message immediately.
        // Change 'testDestroy' to true to see the container vanish.
        const testBirthday = false; 
        const testDestroy = false;

        const targetDate = new Date(`Jan 21, 2026 00:00:00`).getTime();
        const expiryDate = new Date(`Jan 22, 2026 00:00:00`).getTime();
        
        const currentTime = now.getTime();
        const distance = targetDate - currentTime;
        const container = document.getElementById("countdown-container");

        // 1. SELF DESTRUCT LOGIC
        if (currentTime >= expiryDate || testDestroy) {
            container.remove(); // This deletes the element from the HTML entirely
            console.log("Countdown destroyed.");
            return; 
        }

        // 2. BIRTHDAY / END STATE LOGIC
        if (distance <= 0 || testBirthday) {
            document.getElementById("countdown").innerHTML = "Happy Birthday Jishnu!!";
            document.getElementById("countdown").style.fontSize = "1.8rem";
            document.getElementById("countdown").style.color = "#38ff38"; // Neon green for the event
            document.querySelector(".label-container").style.display = "none";
            document.querySelector(".countdown-title").innerHTML = "Celebration Time!";
            return;
        }

        // 3. ACTIVE COUNTDOWN LOGIC
        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        const format = (num) => num.toString().padStart(2, '0');

        document.getElementById("countdown").innerHTML = 
            `${days}:${format(hours)}:${format(minutes)}:${format(seconds)}`;
    }

    // Refresh every second
    setInterval(updateCountdown, 1000);
    updateCountdown();

    
// Import the functions you need from the SDKs you need
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics.js";
// Firestore Imports
import { getFirestore, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";


// Your web app's Firebase configuration
const firebaseConfig = {
apiKey: "AIzaSyDohsquOam8YQXz7tqrWOG5f4pcXh-CnBM",
authDomain: "weapon-fanpage.firebaseapp.com",
projectId: "weapon-fanpage",
storageBucket: "weapon-fanpage.firebasestorage.app",
messagingSenderId: "124549409527",
appId: "1:124549409527:web:85657a1d41c8950f7601f2",
measurementId: "G-MXBR3C8ET7"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
// Initialize Firestore
const db = getFirestore(app);

// Make the database instance and functions available globally for the main script
window.db = db;
window.doc = doc;
window.updateDoc = updateDoc;
window.getDoc = getDoc;

console.log("Firebase Initialized:", app.name);
</script>

<script>
/* DATA - UPDATED */
const artists = {
    "Intermission(LOT-III)": "Jishnu, G.R.Adhavh",
    "Saavachuruven unna(LOT-III)": "Jishnu, G.R.Adhavh, Sanjai",
    "Sivagasi's Daaha(LOT-III)": "G.R.Adhavh, Shreyas",
    "Sivagasis Daaha x Saavachuruven unna(LOT-III)": "G.R.Adhavh, Shreyas, Jishnu",
    "The namechange(LOT-III)": "Kavinraaj, G.R.Adhavh",
    "Flute anthem(LOT-III)": "G.R.Adhavh",
    "Saavadi Saravedi(LOT-III)": "Kavinraaj, G.R.Adhavh",
    "Item number 1(LOT-III)": "Kavinraaj, G.R.Adhavh",
    "Jishnu Anthem": "G.R.Adhavh",
    "Bomb (Endhu 1cm)": "Kavinraaj, Kaliyappan, G.R.Adhavh",
    "Sanjai's room (Endhu 1cm)": "Shreyas, G.R.Adhavh",
    "Harishankar ku irukka?": "Kavinraaj, G.R.Adhavh",
    "Jishnu the flashback(LOT-III)": "Piano cover by G.R.Adhavh",
    "default": "G.R.Adhavh"
};

const songAnimations = {
    "Intermission(LOT-III)": "#ff4d6d",
     "Jishnu the flashback(LOT-III)": "#99ff33",
    "Saavachuruven unna(LOT-III)": "#4dd6ff",
    "default": "#6a5bff"
};

const playlists = {
    list1: ["Anugundu Abhishek.mp3", "DSK on the move.mp3", "Hyper Harishankar.mp3", "Intermission.mp3", "Jishnu Anthem Reprise.mp3", "The fight.mp3", "King in the Universe.mp3", "King vs Harold.mp3", "LOT-III teaser concert.mp3", "LOT-III Theme.mp3", "Saavachuruven unna.mp3", "Sivagasi's Daaha.mp3", "Sivagasis Daaha x Saavachuruven unna.mp3", "The namechange.mp3", "Vadakku Sadhuram il Jishnu.mp3", "Flute anthem.mp3","Jishnu the flashback.mp3"],
    list4: ["Item number 1.mp3", "Saavadi Saravedi.mp3"],
    list2: ["Jishnu Anthem.mp3", "Jishnu anthem Thalapathy Vijay vocal.mp3", "Jishnu Anthem slowed and reverbed.mp3", "Jishnu Anthem Karoke.mp3"],
    list3: ["Harishankar ku irukka.mp3", "Happy Birthday Megharajan.mp3", "Bomb.mp3", "Sanjai.mp3"]
};

// --- UNIVERSAL MAPPING FUNCTION ---
function simplifyDisplayName(displayName) {
    let clean = displayName.toLowerCase();
    if (clean.includes("abhishek")) return "AnugunduAbhishek";
    if (clean.includes("flashback")) return "Jishnutheflashback";
    if (clean.includes("dsk")) return "DSKOnTheMove";
    if (clean.includes("hyper")) return "HyperHarishankar";
    if (clean.includes("intermission")) return "IntermissionLOTIII";
    if (clean.includes("reprise")) return "JishnuAnthemReprise";
    if (clean.includes("fight")) return "TheFightLOTIII";
    if (clean.includes("universe")) return "KingInTheUniverse";
    if (clean.includes("harold")) return "KingVsHarold";
    if (clean.includes("teaser")) return "LOTIIITeaserConcert";
    if (clean.includes("theme")) return "LOTIIITheme";
    if (clean.includes("saavachuruven")) return "SaavachuruvenUnna";
    if (clean.includes("sivagasi")) return "SivagasisDaaha";
    if (clean.includes("flute")) return "FluteAnthemLOTIII";
    if (clean.includes("bomb")) return "BombEndhu1cm";
    if (clean.includes("sanjai")) return "SanjaisRoomEndhu1cm";
    if (clean.includes("vadakku")) return "VadakkuSadhuramIlJishnu";
    if (clean.includes("namechange")) return "TheNamechange";
    if (clean.includes("saravedi")) return "SaavadiSaravedi";
    if (clean.includes("item number 1")) return "Itemnumber1";
    if (clean.includes("vijay") || clean.includes("vocal")) return "JishnuanthemThalapathyVijayvocal";
    if (clean.includes("slowed")) return "JishnuAnthemSlowedReverbed";
    if (clean.includes("karoke")) return "JishnuAnthemKaroke";
    if (clean.includes("jishnu anthem") && !clean.includes("reprise") && !clean.includes("karoke")) return "JishnuAnthem";
    if (clean.includes("birthday") || clean.includes("megharajan")) return "HappyBirthdayMegharajan";
    if (clean.includes("irukka")) return "HarishankarKuIrukka";
    return displayName.replace(/[^a-zA-Z0-9]/g, '');
}

/* 2. AUTOMATIC TRENDING LIST GENERATOR */
const allSongsForTrending = [];
const seenSongs = new Set();

for (let listId in playlists) {
    playlists[listId].forEach(file => {
        let cleanName = file.replace(".mp3", "");
        let displayName = cleanName;
        if (cleanName === "Bomb") displayName = "Bomb (Endhu 1cm)";
        if (cleanName === "Sanjai") displayName = "Sanjai's room (Endhu 1cm)";
        if (cleanName === "Harishankar ku irukka") displayName = "Harishankar ku irukka?";
        if (['list1', 'list4'].includes(listId) && !displayName.includes("(LOT-III)")) displayName += "(LOT-III)";

        if (!seenSongs.has(displayName)) {
            let cover = "Poster.jpg";
            if (displayName.includes("Jishnu Anthem")) cover = "Poster2.jpeg";
            if (displayName.includes("Bomb") || displayName.includes("Sanjai")) cover = "poster4.png";
            if (displayName.includes("Harishankar")) cover = "Poster3.jpeg";
            if (displayName.includes("Happy Birthday")) cover = "poster3.png";

            allSongsForTrending.push({ name: displayName, dbName: simplifyDisplayName(displayName), cover: cover });
            seenSongs.add(displayName);
        }
    });
}

function getArtist(song) { 
    // This looks for the exact match (e.g., "Saavadi Saravedi(LOT-III)")
    // If not found, it tries to trim spaces/question marks
    let name = song.trim();
    return artists[name] || artists[name.replace("?", "")] || artists["default"]; 
}
function getColor(song) { return songAnimations[song] || songAnimations["default"]; }
function formatTime(s) {
    if(isNaN(s)) return "0:00";
    let min = Math.floor(s / 60), sec = Math.floor(s % 60);
    return min + ":" + (sec < 10 ? "0" + sec : sec);
}
function formatViews(num) {
    if (num === undefined) return "0 views";
    return num >= 1000 ? (num / 1000).toFixed(1) + 'K views' : num + ' views';
}

/* 3. TRENDING UI RENDERER */
function renderTrendingUI(viewsMap) {
    const listElem = document.getElementById("trendingList");
    if (!listElem) return;
    listElem.innerHTML = ''; 
    const sortedTrending = allSongsForTrending.slice().sort((a, b) => (viewsMap[b.dbName] || 0) - (viewsMap[a.dbName] || 0));
    sortedTrending.slice(0, 3).forEach((song, idx) => {
        const item = document.createElement("li");
        item.className = "trendingItem";
        let playlistId = null, pIndex = -1;
        for (const id in playlists) {
            pIndex = playlists[id].findIndex(f => {
                let cleanF = f.replace(".mp3", "");
                return cleanF === song.name.replace("(LOT-III)","").replace("?","").trim() || 
                       (cleanF === "Bomb" && song.name.includes("Bomb")) ||
                       (cleanF === "Sanjai" && song.name.includes("Sanjai"));
            });
            if (pIndex !== -1) { playlistId = id; break; }
        }
        item.innerHTML = `<div class="trendingRank">#${idx + 1}</div><img class="trendingCover" src="${song.cover}"><div class="trendingInfo"><div class="trendingTitle">${song.name}</div><div class="trendingViews">${getArtist(song.name)} ‚Ä¢ ${formatViews(viewsMap[song.dbName] || 0)}</div></div>`;
        item.onclick = () => { if (playlistId) playSongByName(playlistId, playlists[playlistId][pIndex]); };
        listElem.appendChild(item);
    });
}

async function fetchAndRenderTrending() {
    if (!window.db) { setTimeout(fetchAndRenderTrending, 100); return; }
    try {
        const docRef = window.doc(window.db, "all_songs_views", "all_song_data");
        const docSnap = await window.getDoc(docRef);
        if (docSnap.exists()) renderTrendingUI(docSnap.data().views_map || {});
    } catch (e) { console.error(e); }
}

async function incrementView(displayName) {
    if (!window.db || !window.updateDoc) return;
    const dbName = simplifyDisplayName(displayName);
    const docRef = window.doc(window.db, "all_songs_views", "all_song_data");
    try {
        const docSnap = await window.getDoc(docRef);
        if (!docSnap.exists()) return;
        const viewsMap = docSnap.data().views_map || {};
        viewsMap[dbName] = (viewsMap[dbName] || 0) + 1;
        await window.updateDoc(docRef, { views_map: viewsMap });
        renderTrendingUI(viewsMap);
    } catch (e) { console.error(e); }
}

/* --- UI GENERATION --- */
for (let id in playlists) {
    if (id === 'list1') playlists[id].sort();
    let listElem = document.getElementById(id);
    if (!listElem) continue;
    [...new Set(playlists[id])].forEach((songFilename) => {
        let fileName = songFilename.replace(".mp3", "");
        let displayName = fileName;
        if (['list1', 'list4'].includes(id) && !displayName.includes("(LOT-III)")) displayName += "(LOT-III)";
        if (fileName === "Bomb") displayName = "Bomb (Endhu 1cm)";
        if (fileName === "Sanjai") displayName = "Sanjai's room (Endhu 1cm)";
        if (fileName === "Harishankar ku irukka") displayName = "Harishankar ku irukka?";

        let div = document.createElement("div");
        div.className = "track";
        div.innerHTML = `<div><strong>${displayName}</strong><br><span>${getArtist(displayName)}</span></div><span>‚ñ∂</span>`;
        div.onclick = (e) => { e.stopPropagation(); playSongByName(id, songFilename); };
        listElem.appendChild(div);
    });
}

fetchAndRenderTrending();

/* --- PLAYER LOGIC --- */
let currentList = null, currentIndex = 0;
const audio = document.getElementById("audio");
const seekSlider = document.getElementById("seekSlider");

window.toggleList = (id) => {
    document.querySelectorAll('.songList').forEach(l => l.style.display="none");
    let el = document.getElementById(id);
    el.style.display = (el.style.display === "block") ? "none" : "block";
};

function playSongByName(listId, filename) {
    currentList = listId;

    currentIndex = playlists[listId].findIndex(
        f => f.trim().toLowerCase() === filename.trim().toLowerCase()
    );

    let fileNameClean = filename.replace(".mp3","");
    let disp = fileNameClean;

    if (['list1', 'list4'].includes(listId) && !disp.includes("(LOT-III)")) disp += "(LOT-III)";
    if (fileNameClean === "Bomb") disp = "Bomb (Endhu 1cm)";
    if (fileNameClean === "Sanjai") disp = "Sanjai's room (Endhu 1cm)";

    incrementView(disp);

    audio.pause();
    audio.src = "";
    audio.load();

    audio.src = filename;
    audio.load();
    audio.play()
        .then(() => document.body.classList.add("pulsing"))
        .catch(e => console.log(e));

    document.getElementById("seekContainer").style.display = "flex";
    showPopup(disp, getArtist(disp), listId, filename);
    applySongTheme(getColor(disp));
    document.getElementById("playPauseIcon").innerText = "‚è∏";
}

window.togglePlay = () => {
    if(!audio.src) return;
    if(audio.paused){ audio.play(); document.body.classList.add("pulsing"); document.getElementById("playPauseIcon").innerText = "‚è∏"; }
    else { audio.pause(); document.body.classList.remove("pulsing"); document.getElementById("playPauseIcon").innerText = "‚ñ∂"; }
};

window.prevSong = () => { currentIndex = (currentIndex - 1 + playlists[currentList].length) % playlists[currentList].length; playSongByName(currentList, playlists[currentList][currentIndex]); };
window.nextSong = () => { currentIndex = (currentIndex + 1) % playlists[currentList].length; playSongByName(currentList, playlists[currentList][currentIndex]); };

audio.addEventListener('ended', window.nextSong);
audio.addEventListener('timeupdate', () => {
    if(audio.duration){
        seekSlider.value = (audio.currentTime / audio.duration) * 100;
        document.getElementById("currTimeText").innerText = formatTime(audio.currentTime);
        document.getElementById("durTimeText").innerText = formatTime(audio.duration);
    }
});
seekSlider.addEventListener('input', () => { audio.currentTime = (seekSlider.value / 100) * audio.duration; });

function applySongTheme(color){
    document.documentElement.style.setProperty('--song-color', color);
    document.body.style.background = `radial-gradient(circle at center, ${color}22 0%, #0a0f2e 100%)`;
    document.querySelector(".player").style.borderColor = color;
}

function showPopup(songName, artist, listId, filename){
    let popup = document.getElementById("popup");
    popup.style.display = "block";
    document.getElementById("popupSongName").innerHTML = `<span>${songName} ‚Äî ${artist}</span>`;
    
    let img = document.getElementById("popupImg");
    img.style.display = "block";
    
    let fName = filename.toLowerCase();

    /* --- UPDATED POSTER LOGIC --- */
if(listId === "list1" || listId === "list4") {
    // 1. Check for the Mix track first (contains both names)
    if(fName.includes("sivagasi") && fName.includes("saavachuruven")) {
        img.src = "sdxsu.png";
    } 
    // 2. Check for the solo track
    else if (fName.includes("sivagasi")) {
        img.src = "sivagasi.png";
    } 
    else {
        img.src = "Poster.jpg";
    }
}
    else if(listId === "list2") {
        img.src = "Poster2.jpeg";
    }
    else if(listId === "list3") {
        // Checking filename for specific list 3 posters
        if(fName.includes("bomb") || fName.includes("sanjai")) {
            img.src = "poster4.png";
        } else if (fName.includes("harishankar")) {
            img.src = "Poster3.jpeg";
        } else if (fName.includes("birthday") || fName.includes("megharajan")) {
            img.src = "poster3.png";
        } else {
            img.src = "Poster3.jpeg";
        }
    } else {
        img.src = "Poster.jpg";
    }
}

window.closePopup = () => { 
    document.getElementById("popup").style.display = "none"; 
    audio.pause(); 
    document.body.classList.remove("pulsing"); 
};
</script>
</body>
</html>












