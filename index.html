<!DOCTYPE html>
<html lang="en">
<head>
<link rel="manifest" href="manifest.json">
<meta charset="UTF-8">
<title>Vibe with Jishnu</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0f2e">¬†

<style>
    .trailer-link-box {

        display: block;

        width: 90%;

        max-width: 700px;

        margin: 10px auto;

        padding: 15px;

        text-align: center;

        background: linear-gradient(90deg, rgba(106, 91, 255, 0.2), rgba(184, 75, 255, 0.2));

        border: 1px solid #6a5bff;

        border-radius: 12px;

        text-decoration: none;

        transition: all 0.3s ease;

        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);

    }

    .trailer-link-box:hover {

        background: linear-gradient(90deg, rgba(106, 91, 255, 0.4), rgba(184, 75, 255, 0.4));

        transform: translateY(-3px);

        box-shadow: 0 0 20px rgba(106, 91, 255, 0.5);

    }

    .trailer-text {

        color: #ffffff;

        font-weight: bold;

        letter-spacing: 2px;

        font-size: 16px;

        text-transform: uppercase;

    }

    .trailer-text span {

        color: #00ffbf; /* Accent color */

        margin-right: 8px;

    }

    

/* ADD THIS NEW BLOCK INSIDE THE <style> TAG */

/* New badge for the playlist container itself */
.playlistContainer.new-release {
    border-color: #38ff38 !important; /* Bright green border */
}
.playlistContainer.new-release .playlistHeader {
    position: relative;
}

/* Style for the "NEW!!" badge */
.playlistContainer.new-release .new-badge {
    position: absolute;
    top: -10px;
    right: -10px;
    background: #38ff38; /* Bright green background */
    color: #0a0f2e;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 10px;
    font-weight: bold;
    letter-spacing: 0.5px;
    transform: rotate(5deg);
    box-shadow: 0 2px 5px rgba(0,0,0,0.4);
}

/* Styling for the playable tracks */
.track.playable-new strong {
    color: #00ffbf; /* Flute Anthem's color for emphasis */
}

/* END OF NEW CSS BLOCK */

  /* ADD THIS NEW BLOCK INSIDE THE <style> TAG */

.trailer-banner {
    width: 90%;
    max-width: 700px;
    margin: 0px auto 10px auto; /* Adds margin below the header and above the playlists */
    border-radius: 12px;
    overflow: hidden;
    position: relative;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    background: #1a0842; /* Fallback background */
}

.trailer-banner img {
    width: 100%;
    height: auto;
    display: block;
    filter: brightness(0.7); /* Slightly darken image so text stands out */
}
/* --- UPDATED COUNTDOWN BLOCK --- */
#countdown-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin: 20px auto;
    width: 90%;
    max-width: 700px;
    padding: 30px 10px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    border: 1px solid rgba(0, 212, 255, 0.3);
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
}

.countdown-title {
    font-size: 1.2rem;
    text-transform: uppercase;
    letter-spacing: 4px;
    color: #00d4ff;
    margin-bottom: 15px;
    font-weight: bold;
    text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
}

#countdown {
    font-size: clamp(2rem, 8vw, 3.5rem); /* Responsive sizing */
    font-weight: 800;
    font-family: 'Courier New', Courier, monospace;
    color: #ffffff;
    letter-spacing: 2px;
    line-height: 1;
}

.label-container {
    display: flex;
    justify-content: center;
    width: 100%;
    max-width: 400px;
    margin-top: 10px;
    opacity: 0.6;
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 2px;
}

/* This helps align the labels under the numbers */
.label-container span {
    flex: 1;
    text-align: center;
}

.banner-caption {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    padding: 15px 20px;
    background: linear-gradient(to top, rgba(10, 15, 46, 0.9), rgba(10, 15, 46, 0));
    color: white;
    font-size: 18px;
    font-weight: bold;
    text-align: center;
    letter-spacing: 1px;
}
.banner-caption span {
    color: #38ff38; /* Uses the "NEW!!" green for the highlight */
}

/* END OF NEW CSS BLOCK */
  
/* PAGE THEME */
body {
margin: 0;
background: #0a0f2e;
color: white;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
overflow-x: hidden;
position: relative;
min-height: 100vh;
}

/* --- THE BEATING HEART BACKGROUND --- */
#bass-bg {
position: fixed;
top: 50%;
left: 50%;
width: 80vw;
height: 80vw;
max-height: 80vh;
max-width: 80vh;
transform: translate(-50%, -50%);
background: radial-gradient(circle, var(--song-color, #6a5bff) 0%, rgba(0,0,0,0) 70%);
opacity: 0;
z-index: -1;
pointer-events: none;
border-radius: 50%;
transition: background 0.5s ease;
}

/* Pulse Animation */
.pulsing #bass-bg {
animation: heartbeat 0.6s cubic-bezier(0.1, 0.7, 1.0, 0.1) infinite;
}

@keyframes heartbeat {
0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.1; }
10% { transform: translate(-50%, -50%) scale(1.5); opacity: 0.6; }
100% { transform: translate(-50%, -50%) scale(1.6); opacity: 0; }
}

/* HEADER */
header {
display: flex;
align-items: center;
gap: 15px;
padding: 20px;
background: rgba(30, 0, 70, 0.8);
backdrop-filter: blur(8px);
border-bottom: 2px solid #6a5bff;
position: sticky;
top: 0;
z-index: 10;
}
header img { height: 50px; }
header h1 {
font-size: 28px;
font-weight: 800;
background: linear-gradient(90deg, #6a5bff, #b84bff);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
margin: 0;
letter-spacing: 1px;
}

/* CONTENT PADDING */
/* Padded to accommodate the fixed player bar at the bottom */
/* Update this block in your <style> tag */
.content { 
    padding-top: 20px; 
    padding-bottom: 250px; /* Increased this to push content above the player */
}

/* PLAYLIST BOX */
.playlistContainer {
width: 90%;
max-width: 700px;
margin: 20px auto;
background: rgba(255,255,255,0.03);
border-radius: 12px;
border: 1px solid rgba(255, 255, 255, 0.1);
padding: 15px;
transition: all 0.3s ease;
cursor: pointer;
}
.playlistContainer:hover {
background: rgba(255,255,255,0.07);
border-color: #6a5bff;
}

.playlistHeader { display: flex; align-items: center; gap: 15px; }
.playlistHeader img {
width: 70px; height: 70px; object-fit: cover;
border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}
.playlistTitle { font-size: 20px; font-weight: bold; }

/* SONG LIST */
.songList { display: none; margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; }
.track {
display: flex; justify-content: space-between; align-items: center;
padding: 12px; border-radius: 6px; margin-bottom: 5px;
cursor: pointer; transition: background 0.2s;
}
.track:hover { background: rgba(255,255,255,0.1); }
.track strong { font-size: 14px; }
.track span { font-size: 12px; opacity: 0.7; }

/* PLAYER BAR - MODIFIED */
.player {
position: fixed;
bottom: 0; left: 0; width: 100%;
background: rgba(10, 5, 30, 0.95);
backdrop-filter: blur(10px);
/* Padding adjusted to move content up */
padding: 10px 0 50px 0; 
display: flex; flex-direction: column;
justify-content: center; align-items: center;
border-top: 2px solid #6a5bff;
transition: border-color 0.5s ease;
z-index: 100;
box-shadow: 0 -10px 30px rgba(0,0,0,0.5);
}

/* Added a small bar at the bottom for visual effect/spacer */
.player::after {
content: "";
position: absolute;
bottom: 0;
left: 0;
width: 100%;
height: 40px; /* This creates the bar space */
background: rgba(10, 5, 30, 1);
z-index: 1;
}

.controls-row {
display: flex; justify-content: center; align-items: center; gap: 30px;
margin-bottom: 10px;
z-index: 2; /* Bring controls above the bottom bar */
}

button.control {
width: 55px; height: 55px; border-radius: 50%; border: none;
background: linear-gradient(135deg, #6a5bff, #b84bff);
color: white; font-size: 20px; cursor: pointer;
transition: transform 0.2s, box-shadow 0.2s;
display: flex; justify-content: center; align-items: center;
box-shadow: 0 4px 15px rgba(106, 91, 255, 0.4);
z-index: 2;
}
button.control:active { transform: scale(0.95); }
button.control:hover { transform: scale(1.1); box-shadow: 0 6px 20px rgba(106, 91, 255, 0.6); }

/* SEEK BAR / SLIDER */
.seek-container {
width: 80%;
max-width: 600px;
display: none;
align-items: center;
gap: 10px;
font-size: 12px;
color: rgba(255,255,255,0.7);
animation: fadeIn 0.5s ease;
margin-bottom: 10px; /* Adjusted spacing */
z-index: 2;
}

@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

input[type="range"] {
-webkit-appearance: none;
width: 100%; height: 4px;
background: rgba(255,255,255,0.2);
border-radius: 2px; outline: none; cursor: pointer;
}
input[type="range"]::-webkit-slider-thumb {
-webkit-appearance: none; width: 14px; height: 14px;
background: var(--song-color, #6a5bff);
border-radius: 50%; cursor: pointer;
box-shadow: 0 0 10px var(--song-color, #6a5bff);
transition: transform 0.1s;
}
input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.3); }

/* POPUP */
#popup {
/* Moved up to clear the new player bar padding */
position: fixed; bottom: 150px; right: 20px; width: 220px;
background: rgba(15, 10, 40, 0.9);
padding: 15px; border-radius: 12px;
border: 1px solid rgba(255,255,255,0.1);
display: none; z-index: 90;
backdrop-filter: blur(10px);
box-shadow: 0 8px 30px rgba(0,0,0,0.6);
animation: slideUp 0.3s ease-out;
}
@keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
#popup img { width: 100%; border-radius: 8px; margin-bottom: 10px; }

/* CLOSE BUTTON STYLE */
#closePopupBtn {
position: absolute;
top: 5px;
right: 8px;
background: none;
border: none;
color: rgba(255, 255, 255, 0.6);
font-size: 22px;
font-weight: bold;
cursor: pointer;
z-index: 100;
padding: 0;
line-height: 1;
transition: color 0.2s;
}
#closePopupBtn:hover {
color: #ff4d6d;
}

/* SCROLLING TITLE */
#popupSongName {
white-space: nowrap; overflow: hidden; width: 100%;
font-size: 14px; text-align: center; margin-bottom: 10px;
color: #fff; font-weight: 600;
}
#popupSongName span { display: inline-block; padding-left: 100%; animation: scrollText 8s linear infinite; }
@keyframes scrollText { 0% { transform: translateX(0%); } 100% { transform: translateX(-100%); } }

/* SOUNDWAVE */
.soundwave { display: flex; justify-content: center; gap: 4px; height: 15px; align-items: flex-end; }
.soundwave div { width: 3px; background: #6a5bff; animation: wave 0.8s infinite ease-in-out; }
.soundwave div:nth-child(2) { animation-delay: 0.1s; }
.soundwave div:nth-child(3) { animation-delay: 0.2s; }
.soundwave div:nth-child(4) { animation-delay: 0.3s; }
.soundwave div:nth-child(5) { animation-delay: 0.4s; }
@keyframes wave { 0%, 100% { height: 3px; } 50% { height: 15px; } }
.paused div { animation-play-state: paused; height: 3px; }

/* TRENDING SECTION STYLES - MODIFIED FOR HORIZONTAL SCROLL */
.trendingSection {
width: 90%;
max-width: 700px;
margin: 40px auto 20px auto;
padding: 15px 0; /* Adjusted padding for internal spacing */
border-radius: 12px;
background: rgba(255,255,255,0.03);
border: 1px solid rgba(255, 255, 255, 0.1);
}
.trendingSection h2 {
font-size: 24px;
border-bottom: 2px solid #b84bff;
padding: 0 15px 5px 15px; /* Added horizontal padding to title */
margin-top: 0;
color: #b84bff;
}
.trendingList {
list-style: none;
padding: 10px 15px;
margin: 0;
display: flex; /* Key for horizontal layout */
overflow-x: auto; /* Enable horizontal scrolling */
gap: 15px;
}
/* Style for horizontal scrollbar (optional, may vary by browser) */
.trendingList::-webkit-scrollbar { height: 6px; }
.trendingList::-webkit-scrollbar-thumb { background: rgba(106, 91, 255, 0.4); border-radius: 3px; }
.trendingList::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }

.trendingItem {
/* Set item width for visibility in horizontal scroll */
flex: 0 0 150px; 
display: flex;
flex-direction: column;
align-items: flex-start;
padding: 10px;
border-radius: 8px;
transition: background 0.2s, transform 0.2s;
cursor: pointer;
}
.trendingItem:hover { 
background: rgba(255,255,255,0.07); 
transform: translateY(-2px);
}
.trendingRank {
font-size: 14px;
font-weight: bold;
color: #6a5bff;
margin-bottom: 5px;
}
.trendingCover {
width: 100%;
height: 150px;
border-radius: 6px;
object-fit: cover;
margin-bottom: 8px;
box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}
.trendingInfo {
flex-grow: 1;
width: 100%;
}
.trendingTitle {
font-size: 14px;
font-weight: bold;
white-space: nowrap;
overflow: hidden;
text-overflow: ellipsis;
}
.trendingViews {
font-size: 11px;
opacity: 0.7;
margin-top: 3px;
}

</style>
</head>
<body class="">
    

<div id="bass-bg"></div>

<header>
<img src="logo.png" alt="Logo" onerror="this.style.display='none'">
<h1>Vibe with Jishnu</h1>
</header>

<div class="trailer-banner">
    <img src="tp.jpg" alt="LOT-III Trailer">
    <div class="banner-caption">
        <span>LOT-III Trailer out now!!</span>
    </div>
</div>
    
<a href="https://drive.google.com/file/d/1sl3XzH4e5rl8wIvRxTHvxDzpU0vTlZPv/view?usp=drivesdk" target="_blank" class="trailer-link-box">

    <div class="trailer-text"><span>‚ñ∂</span> LOT-III OFFICIAL TRAILER</div>

</a>
<div id="countdown-container">
    <div class="countdown-title">LOT-III Release In</div>
    <div id="countdown">00:00:00:00</div>
    <div class="label-container">
        <span>Days</span>
        <span>Hrs</span>
        <span>Min</span>
        <span>Sec</span>
    </div>
</div>


<div class="playlistContainer new-release">
    <div class="playlistHeader" onclick="toggleList('list1')">
        <span class="new-badge">NEW!!</span>
        <img src="Poster.jpg" alt="LOT-III" onerror="this.src='https://via.placeholder.com/80/6a5bff/fff?text=Music'">
        <div>
            <div class="playlistTitle">LOT-III OST</div>
            <div style="font-size:12px; opacity:0.6">Original Sound Track</div>
        </div>
    </div>
    <div id="list1" class="songList"></div>
</div>

<div class="playlistContainer new-release">
    <div class="playlistHeader" onclick="toggleList('list4')">
        <span class="new-badge">NEW!!</span>
        <img src="Poster.jpg" alt="LOT-III Singles" onerror="this.src='https://via.placeholder.com/80/6a5bff/fff?text=Music'">
        <div>
            <div class="playlistTitle">LOT-III Singles</div>
            <div style="font-size:12px; opacity:0.6">Latest Releases</div>
        </div>
    </div>
    <div id="list4" class="songList"></div>
</div>

<div class="playlistContainer">
    <div class="playlistHeader" onclick="toggleList('list2')">
        <img src="Poster2.jpeg" alt="50 Shades" onerror="this.src='https://via.placeholder.com/80/6a5bff/fff?text=Music'">
        <div>
            <div class="playlistTitle">50 Shades of Jishnu Anthem</div>
            <div style="font-size:12px; opacity:0.6">Song of the century</div>
        </div>
    </div>
    <div id="list2" class="songList"></div>
</div>

<div class="playlistContainer">
    <div class="playlistHeader" onclick="toggleList('list3')">
        <img src="Poster3.jpeg" alt="Hits" onerror="this.src='https://via.placeholder.com/80/6a5bff/fff?text=Music'">
        <div>
            <div class="playlistTitle">Blockbuster Hits</div>
            <div style="font-size:12px; opacity:0.6">Fan Favorites</div>
        </div>
    </div>
    <div id="list3" class="songList"></div>
</div>

<div class="trendingSection">
<h2>Trending Songs üî•</h2>
<ul class="trendingList" id="trendingList">
</ul>
</div>
</div>

<div id="popup">
<button id="closePopupBtn" onclick="closePopup()">√ó</button>

<img id="popupImg" src="" onerror="this.style.display='none'">
<div id="popupSongName"></div>
<div class="soundwave" id="soundwave">
<div></div><div></div><div></div><div></div><div></div>
</div>
</div>
<br><br><br><br><br><br><br><br><br><br>
<div class="player">
<div class="controls-row">
<button class="control" onclick="prevSong()">‚èÆ</button>
<button class="control" onclick="togglePlay()">
<span id="playPauseIcon" style="margin-left:2px;">‚ñ∂</span>
</button>
<button class="control" onclick="nextSong()">‚è≠</button>
</div>

<div class="seek-container" id="seekContainer">
<span id="currTimeText">0:00</span>
<input type="range" id="seekSlider" min="0" max="100" value="0">
<span id="durTimeText">0:00</span>
</div>
</div>

<audio id="audio"></audio>

<script type="module">
    // --- FIREBASE INITIALIZATION (Consolidated) ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDohsquOam8YQXz7tqrWOG5f4pcXh-CnBM",
        authDomain: "weapon-fanpage.firebaseapp.com",
        projectId: "weapon-fanpage",
        storageBucket: "weapon-fanpage.firebasestorage.app",
        messagingSenderId: "124549409527",
        appId: "1:124549409527:web:85657a1d41c8950f7601f2"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Global access for the functions used in inline HTML onclicks
    window.db = db;
    window.doc = doc;
    window.updateDoc = updateDoc;
    window.getDoc = getDoc;

    // --- COUNTDOWN LOGIC ---
    function updateCountdown() {
        const now = new Date();
        const targetDate = new Date(`Jan 21, 2026 00:00:00`).getTime();
        const expiryDate = new Date(`Jan 22, 2026 00:00:00`).getTime();
        const currentTime = now.getTime();
        const distance = targetDate - currentTime;
        const container = document.getElementById("countdown-container");

        if (currentTime >= expiryDate) {
            if(container) container.style.display = "none";
            return; 
        }

        if (distance <= 0) {
            document.getElementById("countdown").innerHTML = "Happy Birthday Jishnu";
            document.getElementById("countdown").style.fontSize = "1.8rem";
            document.querySelector(".label-container").style.display = "none";
            document.querySelector(".countdown-title").innerHTML = "Celebration Time!";
            return;
        }

        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);
        const format = (num) => num.toString().padStart(2, '0');

        document.getElementById("countdown").innerHTML = `${days}:${format(hours)}:${format(minutes)}:${format(seconds)}`;
    }

    setInterval(updateCountdown, 1000);
    updateCountdown();
</script>

<script>
    /* TRENDING LOGIC RESTORED */
const allSongsForTrending = Object.keys(artists).filter(key => key !== 'default').map(displayName => {
    let cover = "Poster.jpg";
    if (displayName.includes("Jishnu Anthem")) cover = "Poster2.jpeg";
    if (displayName.includes("Bomb") || displayName.includes("Sanjai")) cover = "poster4.png";
    if (displayName.includes("Harishankar")) cover = "Poster3.jpeg";
    if (displayName.includes("Happy Birthday")) cover = "poster3.png";

    return { 
        name: displayName, 
        dbName: displayName.replace(/[()]/g, '').replace(/[^a-zA-Z0-9]/g, ''), 
        cover: cover 
    };
});

function renderTrendingUI(viewsMap) {
    const listElem = document.getElementById("trendingList");
    listElem.innerHTML = ''; 

    const sortedTrending = allSongsForTrending.slice().sort((a, b) => {
        const viewsA = viewsMap[a.dbName] || 0;
        const viewsB = viewsMap[b.dbName] || 0;
        return viewsB - viewsA;
    });

    sortedTrending.slice(0, 3).forEach((song, idx) => {
        const item = document.createElement("li");
        item.className = "trendingItem";
        
        let playlistId = null, playlistIndex = -1;
        for (const listId in playlists) {
            playlistIndex = playlists[listId].findIndex(f => {
                let clean = f.replace(".mp3", "");
                if (listId === 'list1' || listId === 'list4') {
                   if (clean === "Sivagasis Daaha x Saavachuruven unna") clean = "Sivagasi's Dahaa x Saavachuruven unna(LOT-III)";
                   else if (clean === "Sivagasi's Daaha") clean = "Sivagasi's Daaha(LOT-III)";
                   else clean = clean + "(LOT-III)";
                }
                return clean === song.name;
            });
            if (playlistIndex !== -1) { playlistId = listId; break; }
        }

        item.innerHTML = `
           <div class="trendingRank">#${idx + 1}</div>
           <img class="trendingCover" src="${song.cover}" alt="${song.name}">
           <div class="trendingInfo">
               <div class="trendingTitle">${song.name}</div>
               <div class="trendingViews">${artists[song.name] || "Artist"} ‚Ä¢ ${formatViews(viewsMap[song.dbName])}</div>
           </div>
        `;

        item.onclick = () => { if (playlistId) playSong(playlistId, playlistIndex); };
        listElem.appendChild(item);
    });
}
/* DATA CONFIGURATION */
let currentList = "list1";
let currentIndex = 0;

const artists = {
    "Intermission(LOT-III)": "Jishnu, G.R.Adhavh",
    "Saavachuruven unna(LOT-III)": "Jishnu, G.R.Adhavh, Sanjai",
    "Sivagasi's Daaha(LOT-III)": "G.R.Adhavh, Shreyas",
    "Sivagasi's Dahaa x Saavachuruven unna(LOT-III)": "G.R.Adhavh, Shreyas, Jishnu",
    "The namechange(LOT-III)": "Kavinraaj, G.R.Adhavh",
    "Flute anthem(LOT-III)": "G.R.Adhavh",
    "Item number 1(LOT-III)": "G.R.Adhavh",
    "Saavadi Saravedi(LOT-III)": "Kavinraaj, G.R.Adhavh",
    "Anugundu Abhishek(LOT-III)": "G.R.Adhavh",
    "DSK on the move(LOT-III)": "G.R.Adhavh",
    "Hyper Harishankar(LOT-III)": "G.R.Adhavh",
    "Jishnu Anthem Reprise(LOT-III)": "G.R.Adhavh",
    "The fight(LOT-III)": "G.R.Adhavh",
    "King in the universe(LOT-III)": "G.R.Adhavh",
    "King vs Harold(LOT-III)": "G.R.Adhavh",
    "LOT-III teaser concert(LOT-III)": "G.R.Adhavh",
    "LOT-III Theme(LOT-III)": "G.R.Adhavh",
    "Vadakku Sadhuram il Jishnu(LOT-III)": "G.R.Adhavh",
    "default": "G.R.Adhavh"
};
const songAnimations = {
    "Intermission(LOT-III)": "#ff4d6d",
    "Saavachuruven unna(LOT-III)": "#4dd6ff",
    "Sivagasi's Daaha(LOT-III)": "#ffa600",
    "The namechange(LOT-III)": "#bb6bff",
    "Flute anthem(LOT-III)": "#00ffbf",
    "Item number 1(LOT-III)": "#ffd700",      
    "Saavadi Saravedi(LOT-III)": "#ff4500", 
    "Jishnu Anthem": "#00ff88",
    "default": "#6a5bff"
};
const playlists = {
    list1: [
        "Anugundu Abhishek.mp3", "DSK on the move.mp3", "Hyper Harishankar.mp3",
        "Intermission.mp3", "Jishnu Anthem Reprise.mp3", "The fight.mp3",
        "King in the Universe.mp3", "King vs Harold.mp3", "LOT-III teaser concert.mp3",
        "LOT-III Theme.mp3", "Saavachuruven unna.mp3", "Sivagasi's Daaha.mp3",
        "Sivagasis Daaha x Saavachuruven unna.mp3",
        "The namechange.mp3", "Vadakku Sadhuram il Jishnu.mp3", "Flute anthem.mp3"
    ],
    list4: [ "Item number 1.mp3", "Saavadi Saravedi.mp3" ],
    list2: [ "Jishnu Anthem.mp3", "Jishnu anthem Thalapathy Vijay vocal.mp3", "Jishnu Anthem slowed and reverbed.mp3", "Jishnu Anthem Karoke.mp3" ],
    list3: [ "Harishankar ku irukka.mp3", "Happy Birthday Megharajan.mp3", "Bomb.mp3", "Sanjai.mp3" ]
};
const allSongsForTrending = Object.keys(artists).filter(key => key !== 'default').map(displayName => {
    let cover = "Poster.jpg";
    if (displayName.includes("Jishnu Anthem")) cover = "Poster2.jpeg";
    if (displayName.includes("Bomb") || displayName.includes("Sanjai")) cover = "poster4.png";
    if (displayName.includes("Harishankar")) cover = "Poster3.jpeg";
    if (displayName.includes("Happy Birthday")) cover = "poster3.png";

    return { 
        name: displayName, 
        dbName: displayName.replace(/[()]/g, '').replace(/[^a-zA-Z0-9]/g, ''), 
        cover: cover 
    };
});
function renderTrendingUI(viewsMap) {
    const listElem = document.getElementById("trendingList");
    if (!listElem) return;
    listElem.innerHTML = ''; 

    const sortedTrending = allSongsForTrending.slice().sort((a, b) => {
        const viewsA = viewsMap[a.dbName] || 0;
        const viewsB = viewsMap[b.dbName] || 0;
        return viewsB - viewsA;
    });

    sortedTrending.slice(0, 3).forEach((song, idx) => {
        const item = document.createElement("li");
        item.className = "trendingItem";
        
        let playlistId = null, playlistIndex = -1;
        for (const listId in playlists) {
            playlistIndex = playlists[listId].findIndex(f => {
                let clean = f.replace(".mp3", "");
                if (listId === 'list1' || listId === 'list4') {
                   if (clean === "Sivagasis Daaha x Saavachuruven unna") clean = "Sivagasi's Dahaa x Saavachuruven unna(LOT-III)";
                   else if (clean === "Sivagasi's Daaha") clean = "Sivagasi's Daaha(LOT-III)";
                   else clean = clean + "(LOT-III)";
                }
                return clean === song.name;
            });
            if (playlistIndex !== -1) { playlistId = listId; break; }
        }

        item.innerHTML = `
           <div class="trendingRank">#${idx + 1}</div>
           <img class="trendingCover" src="${song.cover}" alt="${song.name}">
           <div class="trendingInfo">
               <div class="trendingTitle">${song.name}</div>
               <div class="trendingViews">${artists[song.name] || "Artist"} ‚Ä¢ ${formatViews(viewsMap[song.dbName])}</div>
           </div>
        `;
        item.onclick = () => { if (playlistId) playSong(playlistId, playlistIndex); };
        listElem.appendChild(item);
    });
}

function simplifyDisplayName(displayName) {
    return displayName.replace(/[()]/g, '').replace(/[^a-zA-Z0-9]/g, '');
}

function toggleList(id) {
    const el = document.getElementById(id);
    const isVisible = el.style.display === "block";
    document.querySelectorAll('.songList').forEach(list => list.style.display = "none");
    el.style.display = isVisible ? "none" : "block";
}

function setupPlaylists() {
    for (let id in playlists) {
        let listElem = document.getElementById(id);
        if (!listElem) continue;
        playlists[id].forEach((fileName, idx) => {
            let clean = fileName.replace(".mp3", "");
            let displayName = clean;
            if (id === 'list1' || id === 'list4') {
                if (clean === "Sivagasis Daaha x Saavachuruven unna") displayName = "Sivagasi's Dahaa x Saavachuruven unna(LOT-III)";
                else if (clean === "Sivagasi's Daaha") displayName = "Sivagasi's Daaha(LOT-III)";
                else displayName = clean + "(LOT-III)";
            }
            let div = document.createElement("div");
            div.className = "track";
            if (id === 'list1' || id === 'list4') div.classList.add("playable-new");
            let artist = artists[displayName] || "G.R.Adhavh";
            div.innerHTML = `<div><strong>${displayName}</strong><br><span>${artist}</span></div><span>‚ñ∂</span>`;
            div.onclick = () => playSong(id, idx);
            listElem.appendChild(div);
        });
    }
}

async function incrementView(displayName) {
    if (!window.db) return;
    const dbName = simplifyDisplayName(displayName);
    const docRef = window.doc(window.db, "all_songs_views", "all_song_data");
    try {
        const docSnap = await window.getDoc(docRef);
        if (docSnap.exists()) {
            const data = docSnap.data();
            const viewsMap = data.views_map || {};
            viewsMap[dbName] = (viewsMap[dbName] || 0) + 1;
            await window.updateDoc(docRef, { views_map: viewsMap });
            
            // ADD THIS LINE to refresh the trending UI instantly
            renderTrendingUI(viewsMap);
        }
    } catch (e) { console.error("Firebase Update Error:", e); }
}

function applySongTheme(color){
    document.documentElement.style.setProperty('--song-color', color);
    document.body.style.background = `radial-gradient(circle at center, ${color}22 0%, #0a0f2e 100%)`;
    document.querySelectorAll("#soundwave div").forEach(w => w.style.background = color);
}

function playSong(list, index) {
    currentList = list;
    currentIndex = index;
    const fileName = playlists[list][index];
    const audio = document.getElementById("audio");
    audio.src = fileName;
    audio.play();

    // Logic to find display name
    let clean = fileName.replace(".mp3", "");
    let displayName = clean;
    if (list === 'list1' || list === 'list4') {
        if (clean === "Sivagasis Daaha x Saavachuruven unna") displayName = "Sivagasi's Dahaa x Saavachuruven unna(LOT-III)";
        else if (clean === "Sivagasi's Daaha") displayName = "Sivagasi's Daaha(LOT-III)";
        else displayName = clean + "(LOT-III)";
    }

    document.getElementById("playPauseIcon").innerText = "‚è∏";
    document.getElementById("seekContainer").style.display = "flex";
    document.body.classList.add("pulsing");
    
    incrementView(displayName);
    showPopup(displayName, artists[displayName] || "G.R.Adhavh", list);
    applySongTheme(songAnimations[displayName] || "#6a5bff");
}
function togglePlay() {
    const audio = document.getElementById("audio");
    const icon = document.getElementById("playPauseIcon");
    if (audio.paused) {
        audio.play();
        icon.innerText = "‚è∏";
        document.body.classList.add("pulsing");
    } else {
        audio.pause();
        icon.innerText = "‚ñ∂";
        document.body.classList.remove("pulsing");
    }
}

function nextSong() {
    currentIndex = (currentIndex + 1) % playlists[currentList].length;
    playSong(currentList, currentIndex);
}

function prevSong() {
    currentIndex = (currentIndex - 1 + playlists[currentList].length) % playlists[currentList].length;
    playSong(currentList, currentIndex);
}

function closePopup() {
    document.getElementById("popup").style.display = "none";
}

function showPopup(name, artist, list) {
    document.getElementById("popup").style.display = "block";
    document.getElementById("popupSongName").innerHTML = `<span>${name} ‚Äî ${artist}</span>`;
    let img = document.getElementById("popupImg");
    
    if (list === 'list1' || list === 'list4') img.src = "Poster.jpg";
    else if (list === 'list2') img.src = "Poster2.jpeg";
    else {
        if (name.includes("Bomb") || name.includes("Sanjai")) img.src = "poster4.png";
        else if (name.includes("Harishankar")) img.src = "Poster3.jpeg";
        else if (name.includes("Happy Birthday")) img.src = "poster3.png";
        else img.src = "Poster3.jpeg";
    }
}

// Progress Bar Logic
const audio = document.getElementById("audio");
const seekSlider = document.getElementById("seekSlider");
audio.addEventListener('timeupdate', () => {
    const tm = (audio.currentTime / audio.duration) * 100;
    seekSlider.value = tm || 0;
    document.getElementById("currTimeText").innerText = formatTime(audio.currentTime);
    document.getElementById("durTimeText").innerText = formatTime(audio.duration);
});
seekSlider.addEventListener('input', () => {
    audio.currentTime = (seekSlider.value / 100) * audio.duration;
});

function formatTime(s) {
    if(isNaN(s)) return "0:00";
    let m = Math.floor(s/60), sec = Math.floor(s%60);
    return m + ":" + (sec < 10 ? "0" + sec : sec);
}
async function fetchAndRenderTrending() {
    if (!window.db) { 
        setTimeout(fetchAndRenderTrending, 100); 
        return; 
    }
    try {
        const docRef = window.doc(window.db, "all_songs_views", "all_song_data");
        const docSnap = await window.getDoc(docRef);
        if (docSnap.exists()) {
            renderTrendingUI(docSnap.data().views_map || {});
        }
    } catch (e) { 
        console.error("Error fetching trending data:", e); 
    }
}
window.onload = () => {
    setupPlaylists();
    fetchAndRenderTrending(); // Add this line
};
</script>
</body>
</html>

















