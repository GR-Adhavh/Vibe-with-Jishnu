<!DOCTYPE html>
<html lang="en">
<head>
<link rel="manifest" href="manifest.json">
<meta charset="UTF-8">
<title>Vibe with Jishnu</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0f2e">¬†

<style>

        #countdown-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 90%;
            max-width: 600px;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            text-align: center;
        }

        .countdown-title {
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 5px;
            color: #00d4ff;
            margin-bottom: 20px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        #countdown {
            font-size: clamp(2rem, 10vw, 4rem);
            font-weight: 800;
            font-family: 'Courier New', Courier, monospace;
            color: #ffffff;
            letter-spacing: 2px;
            line-height: 1.2;
        }

        .label-container {
            display: flex;
            justify-content: center;
            width: 100%;
            margin-top: 15px;
            opacity: 0.6;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            color: white;
        }

        .label-container span {
            flex: 1;
            text-align: center;
        }

        /* Birthday state styling */
        .birthday-glow {
            color: #38ff38 !important;
            text-shadow: 0 0 20px rgba(56, 255, 56, 0.6) !important;
        }


/* new css ends here*/

/* New badge for the playlist container itself */
.playlistContainer.new-release {
    border-color: #38ff38 !important; /* Bright green border */
}
.playlistContainer.new-release .playlistHeader {
    position: relative;
}

/* Style for the "NEW!!" badge */
.playlistContainer.new-release .new-badge {
    position: absolute;
    top: -10px;
    right: -10px;
    background: #38ff38; /* Bright green background */
    color: #0a0f2e;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 10px;
    font-weight: bold;
    letter-spacing: 0.5px;
    transform: rotate(5deg);
    box-shadow: 0 2px 5px rgba(0,0,0,0.4);
}

/* Styling for the playable tracks */
.track.playable-new strong {
    color: #00ffbf; /* Flute Anthem's color for emphasis */
}

/* END OF NEW CSS BLOCK */

  /* ADD THIS NEW BLOCK INSIDE THE <style> TAG */

.trailer-banner {
    width: 90%;
    max-width: 700px;
    margin: 0px auto 10px auto; /* Adds margin below the header and above the playlists */
    border-radius: 12px;
    overflow: hidden;
    position: relative;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    background: #1a0842; /* Fallback background */
}

.trailer-banner img {
    width: 100%;
    height: auto;
    display: block;
    filter: brightness(0.7); /* Slightly darken image so text stands out */
}

.banner-caption {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    padding: 15px 20px;
    background: linear-gradient(to top, rgba(10, 15, 46, 0.9), rgba(10, 15, 46, 0));
    color: white;
    font-size: 18px;
    font-weight: bold;
    text-align: center;
    letter-spacing: 1px;
}
.banner-caption span {
    color: #38ff38; /* Uses the "NEW!!" green for the highlight */
}

/* END OF NEW CSS BLOCK */
  
/* PAGE THEME */
body {
margin: 0;
background: #0a0f2e;
color: white;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
overflow-x: hidden;
position: relative;
min-height: 100vh;
}

/* --- THE BEATING HEART BACKGROUND --- */
#bass-bg {
position: fixed;
top: 50%;
left: 50%;
width: 80vw;
height: 80vw;
max-height: 80vh;
max-width: 80vh;
transform: translate(-50%, -50%);
background: radial-gradient(circle, var(--song-color, #6a5bff) 0%, rgba(0,0,0,0) 70%);
opacity: 0;
z-index: -1;
pointer-events: none;
border-radius: 50%;
transition: background 0.5s ease;
}

/* Pulse Animation */
.pulsing #bass-bg {
animation: heartbeat 0.6s cubic-bezier(0.1, 0.7, 1.0, 0.1) infinite;
}

@keyframes heartbeat {
0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.1; }
10% { transform: translate(-50%, -50%) scale(1.5); opacity: 0.6; }
100% { transform: translate(-50%, -50%) scale(1.6); opacity: 0; }
}

/* HEADER */
header {
display: flex;
align-items: center;
gap: 15px;
padding: 20px;
background: rgba(30, 0, 70, 0.8);
backdrop-filter: blur(8px);
border-bottom: 2px solid #6a5bff;
position: sticky;
top: 0;
z-index: 10;
}
header img { height: 50px; }
header h1 {
font-size: 28px;
font-weight: 800;
background: linear-gradient(90deg, #6a5bff, #b84bff);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
margin: 0;
letter-spacing: 1px;
}

/* CONTENT PADDING */
/* Padded to accommodate the fixed player bar at the bottom */
.content { 
    /* Add padding to the top to push content down slightly */
    padding-top: 20px; 
    padding-bottom: 160px; 
}

/* PLAYLIST BOX */
.playlistContainer {
width: 90%;
max-width: 700px;
margin: 20px auto;
background: rgba(255,255,255,0.03);
border-radius: 12px;
border: 1px solid rgba(255, 255, 255, 0.1);
padding: 15px;
transition: all 0.3s ease;
cursor: pointer;
}
.playlistContainer:hover {
background: rgba(255,255,255,0.07);
border-color: #6a5bff;
}

.playlistHeader { display: flex; align-items: center; gap: 15px; }
.playlistHeader img {
width: 70px; height: 70px; object-fit: cover;
border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}
.playlistTitle { font-size: 20px; font-weight: bold; }

/* SONG LIST */
.songList { display: none; margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; }
.track {
display: flex; justify-content: space-between; align-items: center;
padding: 12px; border-radius: 6px; margin-bottom: 5px;
cursor: pointer; transition: background 0.2s;
}
.track:hover { background: rgba(255,255,255,0.1); }
.track strong { font-size: 14px; }
.track span { font-size: 12px; opacity: 0.7; }

/* PLAYER BAR - MODIFIED */
.player {
position: fixed;
bottom: 0; left: 0; width: 100%;
background: rgba(10, 5, 30, 0.95);
backdrop-filter: blur(10px);
/* Padding adjusted to move content up */
padding: 10px 0 50px 0; 
display: flex; flex-direction: column;
justify-content: center; align-items: center;
border-top: 2px solid #6a5bff;
transition: border-color 0.5s ease;
z-index: 100;
box-shadow: 0 -10px 30px rgba(0,0,0,0.5);
}

/* Added a small bar at the bottom for visual effect/spacer */
.player::after {
content: "";
position: absolute;
bottom: 0;
left: 0;
width: 100%;
height: 40px; /* This creates the bar space */
background: rgba(10, 5, 30, 1);
z-index: 1;
}

.controls-row {
display: flex; justify-content: center; align-items: center; gap: 30px;
margin-bottom: 10px;
z-index: 2; /* Bring controls above the bottom bar */
}

button.control {
width: 55px; height: 55px; border-radius: 50%; border: none;
background: linear-gradient(135deg, #6a5bff, #b84bff);
color: white; font-size: 20px; cursor: pointer;
transition: transform 0.2s, box-shadow 0.2s;
display: flex; justify-content: center; align-items: center;
box-shadow: 0 4px 15px rgba(106, 91, 255, 0.4);
z-index: 2;
}
button.control:active { transform: scale(0.95); }
button.control:hover { transform: scale(1.1); box-shadow: 0 6px 20px rgba(106, 91, 255, 0.6); }

/* SEEK BAR / SLIDER */
.seek-container {
width: 80%;
max-width: 600px;
display: none;
align-items: center;
gap: 10px;
font-size: 12px;
color: rgba(255,255,255,0.7);
animation: fadeIn 0.5s ease;
margin-bottom: 10px; /* Adjusted spacing */
z-index: 2;
}

@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

input[type="range"] {
-webkit-appearance: none;
width: 100%; height: 4px;
background: rgba(255,255,255,0.2);
border-radius: 2px; outline: none; cursor: pointer;
}
input[type="range"]::-webkit-slider-thumb {
-webkit-appearance: none; width: 14px; height: 14px;
background: var(--song-color, #6a5bff);
border-radius: 50%; cursor: pointer;
box-shadow: 0 0 10px var(--song-color, #6a5bff);
transition: transform 0.1s;
}
input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.3); }

/* POPUP */
#popup {
/* Moved up to clear the new player bar padding */
position: fixed; bottom: 150px; right: 20px; width: 220px;
background: rgba(15, 10, 40, 0.9);
padding: 15px; border-radius: 12px;
border: 1px solid rgba(255,255,255,0.1);
display: none; z-index: 90;
backdrop-filter: blur(10px);
box-shadow: 0 8px 30px rgba(0,0,0,0.6);
animation: slideUp 0.3s ease-out;
}
@keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
#popup img { width: 100%; border-radius: 8px; margin-bottom: 10px; }

/* CLOSE BUTTON STYLE */
#closePopupBtn {
position: absolute;
top: 5px;
right: 8px;
background: none;
border: none;
color: rgba(255, 255, 255, 0.6);
font-size: 22px;
font-weight: bold;
cursor: pointer;
z-index: 100;
padding: 0;
line-height: 1;
transition: color 0.2s;
}
#closePopupBtn:hover {
color: #ff4d6d;
}

/* SCROLLING TITLE */
#popupSongName {
white-space: nowrap; overflow: hidden; width: 100%;
font-size: 14px; text-align: center; margin-bottom: 10px;
color: #fff; font-weight: 600;
}
#popupSongName span { display: inline-block; padding-left: 100%; animation: scrollText 8s linear infinite; }
@keyframes scrollText { 0% { transform: translateX(0%); } 100% { transform: translateX(-100%); } }

/* SOUNDWAVE */
.soundwave { display: flex; justify-content: center; gap: 4px; height: 15px; align-items: flex-end; }
.soundwave div { width: 3px; background: #6a5bff; animation: wave 0.8s infinite ease-in-out; }
.soundwave div:nth-child(2) { animation-delay: 0.1s; }
.soundwave div:nth-child(3) { animation-delay: 0.2s; }
.soundwave div:nth-child(4) { animation-delay: 0.3s; }
.soundwave div:nth-child(5) { animation-delay: 0.4s; }
@keyframes wave { 0%, 100% { height: 3px; } 50% { height: 15px; } }
.paused div { animation-play-state: paused; height: 3px; }

/* TRENDING SECTION STYLES - MODIFIED FOR HORIZONTAL SCROLL */
.trendingSection {
width: 90%;
max-width: 700px;
margin: 40px auto 20px auto;
padding: 15px 0; /* Adjusted padding for internal spacing */
border-radius: 12px;
background: rgba(255,255,255,0.03);
border: 1px solid rgba(255, 255, 255, 0.1);
}
.trendingSection h2 {
font-size: 24px;
border-bottom: 2px solid #b84bff;
padding: 0 15px 5px 15px; /* Added horizontal padding to title */
margin-top: 0;
color: #b84bff;
}
.trendingList {
list-style: none;
padding: 10px 15px;
margin: 0;
display: flex; /* Key for horizontal layout */
overflow-x: auto; /* Enable horizontal scrolling */
gap: 15px;
}
/* Style for horizontal scrollbar (optional, may vary by browser) */
.trendingList::-webkit-scrollbar { height: 6px; }
.trendingList::-webkit-scrollbar-thumb { background: rgba(106, 91, 255, 0.4); border-radius: 3px; }
.trendingList::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }

.trendingItem {
/* Set item width for visibility in horizontal scroll */
flex: 0 0 150px; 
display: flex;
flex-direction: column;
align-items: flex-start;
padding: 10px;
border-radius: 8px;
transition: background 0.2s, transform 0.2s;
cursor: pointer;
}
.trendingItem:hover { 
background: rgba(255,255,255,0.07); 
transform: translateY(-2px);
}
.trendingRank {
font-size: 14px;
font-weight: bold;
color: #6a5bff;
margin-bottom: 5px;
}
.trendingCover {
width: 100%;
height: 150px;
border-radius: 6px;
object-fit: cover;
margin-bottom: 8px;
box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}
.trendingInfo {
flex-grow: 1;
width: 100%;
}
.trendingTitle {
font-size: 14px;
font-weight: bold;
white-space: nowrap;
overflow: hidden;
text-overflow: ellipsis;
}
.trendingViews {
font-size: 11px;
opacity: 0.7;
margin-top: 3px;
}

</style>
</head>
<body class="">

<div id="bass-bg"></div>

<header>
<img src="logo.png" alt="Logo" onerror="this.style.display='none'">
<h1>Vibe with Jishnu</h1>
</header>

<div class="trailer-banner">
    <img src="tp.jpg" alt="LOT-III Trailer">
    <div class="banner-caption">
        <span>LOT-III Trailer out now!!</span>
    </div>
</div>

    
<div id="countdown-container">
    <div class="countdown-title" id="title">LOT-III Release In</div>
    <div id="countdown">00:00:00:00</div>
    <div class="label-container" id="labels">
        <span>Days</span>
        <span>Hrs</span>
        <span>Min</span>
        <span>Sec</span>
    </div>
        </div>
<div class="playlistContainer new-release">
    <div class="playlistHeader" onclick="toggleList('list1')">
        <span class="new-badge">NEW!!</span>
        <img src="Poster.jpg" alt="LOT-III" onerror="this.src='https://via.placeholder.com/80/6a5bff/fff?text=Music'">
        <div>
            <div class="playlistTitle">LOT-III OST</div>
            <div style="font-size:12px; opacity:0.6">Original Sound Track</div>
        </div>
    </div>
    <div id="list1" class="songList"></div>
</div>

<div class="playlistContainer">
    <div class="playlistHeader" onclick="toggleList('list4')">
        <img src="Poster.jpg" alt="LOT-III Singles" onerror="this.src='https://via.placeholder.com/80/6a5bff/fff?text=Music'">
        <div>
            <div class="playlistTitle">LOT-III Singles</div>
            <div style="font-size:12px; opacity:0.6">Latest Releases</div>
        </div>
    </div>
    <div id="list4" class="songList"></div>
</div>

<div class="playlistContainer">
    <div class="playlistHeader" onclick="toggleList('list2')">
        <img src="Poster2.jpeg" alt="50 Shades" onerror="this.src='https://via.placeholder.com/80/6a5bff/fff?text=Music'">
        <div>
            <div class="playlistTitle">50 Shades of Jishnu Anthem</div>
            <div style="font-size:12px; opacity:0.6">Song of the century</div>
        </div>
    </div>
    <div id="list2" class="songList"></div>
</div>

<div class="playlistContainer">
    <div class="playlistHeader" onclick="toggleList('list3')">
        <img src="Poster3.jpeg" alt="Hits" onerror="this.src='https://via.placeholder.com/80/6a5bff/fff?text=Music'">
        <div>
            <div class="playlistTitle">Blockbuster Hits</div>
            <div style="font-size:12px; opacity:0.6">Fan Favorites</div>
        </div>
    </div>
    <div id="list3" class="songList"></div>
</div>

<div class="trendingSection">
<h2>Trending Songs üî•</h2>
<ul class="trendingList" id="trendingList">
</ul>
</div>
</div>

<div id="popup">
<button id="closePopupBtn" onclick="closePopup()">√ó</button>

<img id="popupImg" src="" onerror="this.style.display='none'">
<div id="popupSongName"></div>
<div class="soundwave" id="soundwave">
<div></div><div></div><div></div><div></div><div></div>
</div>
</div>

<div class="player">
<div class="controls-row">
<button class="control" onclick="prevSong()">‚èÆ</button>
<button class="control" onclick="togglePlay()">
<span id="playPauseIcon" style="margin-left:2px;">‚ñ∂</span>
</button>
<button class="control" onclick="nextSong()">‚è≠</button>
</div>

<div class="seek-container" id="seekContainer">
<span id="currTimeText">0:00</span>
<input type="range" id="seekSlider" min="0" max="100" value="0">
<span id="durTimeText">0:00</span>
</div>
</div>

<audio id="audio"></audio>

<script type="module">
// Import the functions you need from the SDKs you need
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics.js";
// Firestore Imports
import { getFirestore, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";


// Your web app's Firebase configuration
const firebaseConfig = {
apiKey: "AIzaSyDohsquOam8YQXz7tqrWOG5f4pcXh-CnBM",
authDomain: "weapon-fanpage.firebaseapp.com",
projectId: "weapon-fanpage",
storageBucket: "weapon-fanpage.firebasestorage.app",
messagingSenderId: "124549409527",
appId: "1:124549409527:web:85657a1d41c8950f7601f2",
measurementId: "G-MXBR3C8ET7"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
// Initialize Firestore
const db = getFirestore(app);

// Make the database instance and functions available globally for the main script
window.db = db;
window.doc = doc;
window.updateDoc = updateDoc;
window.getDoc = getDoc;

console.log("Firebase Initialized:", app.name);
</script>

<script>
    function updateCountdown() {
        const now = new Date();
        
        // TARGET: Jan 21, 2026
        const targetDate = new Date(`January 21, 2026 00:00:00`).getTime();
        // EXPIRY: Jan 22, 2026 (When it gets destroyed)
        const expiryDate = new Date(`January 22, 2026 00:00:00`).getTime();
        
        const currentTime = now.getTime();
        const distance = targetDate - currentTime;
        
        const container = document.getElementById("countdown-container");
        const display = document.getElementById("countdown");
        const title = document.getElementById("title");
        const labels = document.getElementById("labels");

        // 1. DESTROY: If it is Jan 22nd or later
        if (currentTime >= expiryDate) {
            container.remove(); // Completely removes the element from the DOM
            return;
        }

        // 2. CELEBRATE: If it is Jan 21st
        if (distance <= 0) {
            title.innerHTML = "Celebration Time!";
            display.innerHTML = "Happy Birthday Jishnu!!";
            display.classList.add("birthday-glow");
            display.style.fontSize = "2.2rem"; 
            labels.style.display = "none"; // Hide the Days/Min labels
            return;
        }

        // 3. COUNTDOWN: Normal countdown logic
        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        const format = (num) => num.toString().padStart(2, '0');

        display.innerHTML = `${days}:${format(hours)}:${format(minutes)}:${format(seconds)}`;
    }

    // Refresh every second
    setInterval(updateCountdown, 1000);
    // Run immediately on load
    updateCountdown();
/* new script ends here DATA - UPDATED */
const artists = {
"Intermission(LOT-III)": "Jishnu, G.R.Adhavh",
"Saavachuruven unna(LOT-III)": "Jishnu, G.R.Adhavh, Sanjai",
"Sivagasi's Daaha(LOT-III)": "G.R.Adhavh, Shreyas",
"Sivagasi's Dahaa x Saavachuruven unna(LOT-III)": "G.R.Adhavh, Shreyas, Jishnu",
"The namechange(LOT-III)": "Kavinraaj, G.R.Adhavh",
"Flute anthem(LOT-III)": "G.R.Adhavh",
"Item number 1(LOT-III)": "G.R.Adhavh",
"Saavadi Saravedi(LOT-III)": "Kavinraaj, G.R.Adhavh",
"Jishnu Anthem": "G.R.Adhavh",
"Jishnu Anthem Thalapathy Vijay Vocal": "G.R.Adhavh",
"Jishnu Anthem slowed and reverbed": "G.R.Adhavh",
"Jishnu Anthem Karoke": "G.R.Adhavh",
"Harishankar ku irukka?": "Kavinraaj, G.R.Adhavh",
"Happy Birthday Megharajan": "G.R.Adhavh",
"Bomb (Endhu 1cm)": "Kavinraaj, Kaliyappan, G.R.Adhavh",
"Sanjai's room (Endhu 1cm)": "Shreyas, G.R.Adhavh",
"default": "G.R.Adhavh"
};

const songAnimations = {
"Intermission(LOT-III)": "#ff4d6d",
"Saavachuruven unna(LOT-III)": "#4dd6ff",
"Sivagasi's Daaha(LOT-III)": "#ffa600",
"The namechange(LOT-III)": "#bb6bff",
"Flute anthem(LOT-III)": "#00ffbf",
"Item number 1(LOT-III)": "#ffd700",¬† ¬† ¬† 
"Saavadi Saravedi(LOT-III)": "#ff4500", 
"Jishnu Anthem": "#00ff88",
"Jishnu Anthem Thalapathy Vijay Vocal": "#ccff00",
"Jishnu Anthem slowed and reverbed": "#00ccff",
"Jishnu Anthem Karoke": "#ffffff",
"Harishankar ku irukka?": "#ff0055",
"Happy Birthday Megharajan": "#a600ff",
"Bomb (Endhu 1cm)": "#ff3300",¬† ¬† ¬† ¬† ¬†¬†
"Sanjai's room (Endhu 1cm)": "#ff00cc",
"default": "#6a5bff"
};

const playlists = {
list1: [
"Anugundu Abhishek(LOT-III).mp3", "DSK on the move(LOT-III).mp3", "Hyper Harishankar(LOT-III).mp3",
"Intermission(LOT-III).mp3", "Jishnu Anthem Reprise(LOT-III).mp3", "The fight(LOT-III).mp3",
"King in the universe(LOT-III).mp3", "King vs Harold(LOT-III).mp3", "LOT-III teaser concert.mp3",
"LOT-III Theme(LOT-III).mp3", "Saavachuruven unna(LOT-III).mp3", "Sivagasi's Daaha(LOT-III).mp3",
"Sivagasi's Dahaa x Saavachuruven unna(LOT-III).mp3",
"The namechange(LOT-III).mp3", "Vadakku Sadhuram il Jishnu(LOT-III).mp3", "Flute anthem.mp3"
],
list4: [
"Item number 1(LOT-III).mp3", "Saavadi Saravedi(LOT-III).mp3"
],
list2: [
"Jishnu Anthem.mp3", "Jishnu anthem Thalapathy Vijay vocal.mp3", // <-- FIX APPLIED HERE
"Jishnu Anthem slowed and reverbed.mp3", "Jishnu Anthem Karoke.mp3"
],
list3: [
"Harishankar ku irukka.mp3",¬†"Happy Birthday Megharajan.mp3",
"Bomb.mp3",¬†"Sanjai.mp3"¬†
]
};

// Helper function to map Display Name (from 'artists' object) to a simplified DB key
function simplifyDisplayName(displayName) {
// This must match the field names you created in the 'all_song_data' map!
if (displayName === "Anugundu Abhishek(LOT-III)") return "AnugunduAbhishek";
if (displayName === "DSK on the move(LOT-III)") return "DSKOnTheMove";
if (displayName === "Hyper Harishankar(LOT-III)") return "HyperHarishankar";
if (displayName === "Intermission(LOT-III)") return "IntermissionLOTIII";
if (displayName === "Jishnu Anthem Reprise(LOT-III)") return "JishnuAnthemReprise";
if (displayName === "The fight(LOT-III)") return "TheFightLOTIII";
if (displayName === "King in the universe(LOT-III)") return "KingInTheUniverse";
if (displayName === "King vs Harold(LOT-III)") return "KingVsHarold";
if (displayName === "LOT-III teaser concert(LOT-III)") return "LOTIIITeaserConcert";
if (displayName === "LOT-III Theme(LOT-III)") return "LOTIIITheme";
if (displayName === "Saavachuruven unna(LOT-III)") return "SaavachuruvenUnna";
if (displayName === "Sivagasi's Daaha(LOT-III)") return "SivagasisDaaha";
if (displayName === "The namechange(LOT-III)") return "TheNamechange";
if (displayName === "Vadakku Sadhuram il Jishnu(LOT-III)") return "VadakkuSadhuramIlJishnu";
if (displayName === "Flute anthem(LOT-III)") return "FluteAnthemLOTIII";
if (displayName === "Item number 1(LOT-III)") return "ItemNumber1";
if (displayName === "Saavadi Saravedi(LOT-III)") return "SaavadiSaravedi";
if (displayName === "Jishnu Anthem") return "JishnuAnthem";
if (displayName === "Jishnu Anthem Thalapathy Vijay Vocal") return "JishnuAnthemThalapathyVijayVocal";
if (displayName === "Jishnu Anthem slowed and reverbed") return "JishnuAnthemSlowedReverbed";
if (displayName === "Jishnu Anthem Karoke") return "JishnuAnthemKaroke";
if (displayName === "Harishankar ku irukka?") return "HarishankarKuIrukka";
if (displayName === "Happy Birthday Megharajan") return "HappyBirthdayMegharajan";
if (displayName === "Bomb (Endhu 1cm)") return "BombEndhu1cm";
if (displayName === "Sanjai's room (Endhu 1cm)") return "SanjaisRoomEndhu1cm";

return displayName.replace(/[^a-zA-Z0-9]/g, '');
}

// üÜï This generates the full list of all songs for the trending renderer to use
const allSongsForTrending = Object.keys(artists).filter(key => key !== 'default').map(displayName => {
// Find the associated cover image based on the playlist logic used in showPopup
let cover = "Poster.jpg"; // Default
if (displayName.includes("Jishnu Anthem")) cover = "Poster2.jpeg";
if (displayName.includes("Bomb (Endhu 1cm)") || displayName.includes("Sanjai's room")) cover = "poster4.png";
if (displayName.includes("Harishankar ku irukka")) cover = "Poster3.jpeg";
if (displayName.includes("Happy Birthday")) cover = "poster3.png";

return { 
name: displayName,
dbName: simplifyDisplayName(displayName),
cover: cover
};
});


/* UTILS */
function getArtist(song) { return artists[song.replace(".mp3","")] || artists["default"]; }
function getColor(song) { return songAnimations[song.replace(".mp3","")] || songAnimations["default"]; }

function formatViews(num) {
if (num === undefined) return "N/A views";
if (num >= 1000) {
return (num / 1000).toFixed(1) + 'K views';
}
return num + ' views';
}

/**
// removed invalid comment
// removed invalid comment
// removed invalid comment
*/
function renderTrendingUI(viewsMap) {
const listElem = document.getElementById("trendingList");
listElem.innerHTML = ''; 

// 1. Sort the full list of ALL songs based on views from the fetched map
const sortedTrending = allSongsForTrending.slice().sort((a, b) => {
const viewsA = viewsMap[a.dbName] || 0;
const viewsB = viewsMap[b.dbName] || 0;
return viewsB - viewsA;
});

// 2. Limit the list to the top 3 songs
const top3Trending = sortedTrending.slice(0, 3);


// 3. Render UI using the top 3 list
top3Trending.forEach((song, idx) => {
const item = document.createElement("li");
item.className = "trendingItem";

// Find the correct playlist index for playback 
let playlistIndex = -1;
let playlistId = null;

// Determine which playlist the song belongs to for the onclick handler
for (const listId in playlists) {
playlistIndex = playlists[listId].findIndex(file => {
let fileName = file.replace(".mp3", "");
let songNameFromDB = song.name;

if (songNameFromDB === "Harishankar ku irukka?") return fileName === "Harishankar ku irukka";

if (songNameFromDB === "Harishankar ku irukka?") return fileName === "Harishankar ku irukka";
if (songNameFromDB === "LOT-III teaser concert(LOT-III)") return fileName === "LOT-III teaser concert";
if (songNameFromDB === "Sanjai's room (Endhu 1cm)") return fileName === "Sanjai";
if (songNameFromDB === "Flute anthem(LOT-III)") return fileName === "Flute anthem";
                if (songNameFromDB === "Jishnu Anthem Thalapathy Vijay Vocal") return fileName === "Jishnu Anthem Thalapathy Vijay vocal";
                
                // CRITICAL CHECK for the Thalapathy song's actual file name
                if (songNameFromDB === "Jishnu Anthem Thalapathy Vijay Vocal") return fileName === "Jishnu anthem Thalapathy Vijay vocal";

return fileName === songNameFromDB;
});
if (playlistIndex !== -1) {
playlistId = listId;
break;
}
}

const artist = getArtist(song.name);
const currentViews = viewsMap[song.dbName] || 0;

item.innerHTML = `
           <div class="trendingRank">#${idx + 1}</div>
           <img class="trendingCover" src="${song.cover}" alt="${song.name}">
           <div class="trendingInfo">
               <div class="trendingTitle">${song.name}</div>
               <div class="trendingViews" id="views-${song.dbName}">${artist} ‚Ä¢ ${formatViews(currentViews)}</div>
           </div>
       `;

item.onclick = (e) => {
e.stopPropagation();
if (playlistId) {
// Check for "Dropping Soon" restrictions before playing
const isRestricted = (playlistId === 'list4') || 
                     (playlistId === 'list1' && 
                      song.name !== "Flute anthem(LOT-III)" && 
                      song.name !== "LOT-III teaser concert(LOT-III)");

if (isRestricted) {
    alert("Dropping soon! üöÄ");
} else {
    playSong(playlistId, playlistIndex);
}
}
};
listElem.appendChild(item);
});
}

/**
// removed invalid comment
*/
async function fetchAndRenderTrending() {
if (!window.db) {
setTimeout(fetchAndRenderTrending, 100); 
return;
}

try {
// --- READ THE SINGLE DOCUMENT: "all_songs_views" / "all_song_data" ---
const docRef = window.doc(window.db, "all_songs_views", "all_song_data");
const docSnap = await window.getDoc(docRef);

if (docSnap.exists()) {
const data = docSnap.data();
renderTrendingUI(data.views_map || {}); 
} else {
console.warn("Views document does not exist. Please ensure the document 'all_song_data' exists in the 'all_songs_views' collection.");
renderTrendingUI({});
}

} catch (e) {
console.error("Error fetching trending data:", e);
}
}


/**
// removed invalid comment
// removed invalid comment
*/
async function incrementView(displayName) {
if (!window.db || !window.updateDoc || !window.getDoc) {
return;
}

// üÜï Use the new function to map display name to the DB field name
const dbName = simplifyDisplayName(displayName);
if (!dbName) return; 

// --- REFERENCE THE SINGLE DOCUMENT: "all_songs_views" / "all_song_data" ---
const docRef = window.doc(window.db, "all_songs_views", "all_song_data");

try {
const docSnap = await window.getDoc(docRef);
if (!docSnap.exists()) {
console.error("Single views document not found. Cannot increment.");
return;
}

const data = docSnap.data();
const viewsMap = data.views_map || {};

// 2. Read the specific view count and increment it locally
const currentViews = viewsMap[dbName] || 0;
viewsMap[dbName] = currentViews + 1;

// 3. Write the ENTIRE updated document back to Firestore
await window.updateDoc(docRef, {
views_map: viewsMap
});

// 4. Update the UI
renderTrendingUI(viewsMap);

} catch (e) {
console.error(`Error incrementing views for ${displayName}:`, e);
}
}


/* UI GENERATION (for playlists) */
for(let id in playlists){
if(id === 'list1') playlists[id].sort();

let listElem = document.getElementById(id);

playlists[id].forEach((song, idx)=>{
let clean = song.replace(".mp3","");
let displayName = clean;
if(clean === "Harishankar ku irukka") displayName = "Harishankar ku irukka?";
if(clean === "Bomb") displayName = "Bomb (Endhu 1cm)";
if(clean === "Sanjai") displayName = "Sanjai's room (Endhu 1cm)";
if(clean === "Flute anthem") displayName = "Flute anthem(LOT-III)";
if(clean === "Jishnu Anthem Thalapathy Vijay vocal") displayName = "Jishnu Anthem Thalapathy Vijay Vocal";
if(clean === "LOT-III teaser concert") displayName = "LOT-III teaser concert(LOT-III)"; // ‚¨ÖÔ∏è **THIS IS THE CRITICAL MISSING LINE**

// üÜï Increment view will now work for ALL songs played
incrementView(displayName);
let artist = getArtist(displayName) || getArtist(clean);

let div = document.createElement("div");
div.className="track";

// üÜï Check if the track is one of the new, playable releases
if (id === 'list1' && (displayName === "Flute anthem(LOT-III)" || displayName === "LOT-III teaser concert(LOT-III)")) {
    div.classList.add("playable-new");
}

div.innerHTML = `<div><strong>${displayName}</strong><br><span>${artist}</span></div><span style="font-size:10px;">‚ñ∂</span>`;

div.onclick = (e) => {¬†
e.stopPropagation();¬†

if (id === 'list4' || (id === 'list1' && displayName !== "Flute anthem(LOT-III)"&& 
                      displayName !== "LOT-III teaser concert(LOT-III)")) {
alert("Dropping soon! üöÄ");
}
else {
playSong(id, idx);¬†
}
};

listElem.appendChild(div);
});
}

// üÜï Initial render of trending songs fetches data from the single document
fetchAndRenderTrending();


function toggleList(id){
document.querySelectorAll('.songList').forEach(l => { if(l.id!==id) l.style.display="none"; });
let el = document.getElementById(id);
el.style.display = (el.style.display === "block") ? "none" : "block";
}

/* PLAYER LOGIC */
let currentList = null, currentIndex = 0;
let audio = document.getElementById("audio");
let seekSlider = document.getElementById("seekSlider");
let currTimeText = document.getElementById("currTimeText");
let durTimeText = document.getElementById("durTimeText");

audio.addEventListener('ended', nextSong);

audio.addEventListener('timeupdate', () => {
if(audio.duration){
let pct = (audio.currentTime / audio.duration) * 100;
seekSlider.value = pct;
currTimeText.innerText = formatTime(audio.currentTime);
durTimeText.innerText = formatTime(audio.duration);
}
});

seekSlider.addEventListener('input', () => {
if(audio.duration){
let seekTime = (seekSlider.value / 100) * audio.duration;
audio.currentTime = seekTime;
}
});

function playSong(list, index){
if(!playlists[list] || playlists[list].length === 0) return;

currentList = list;
currentIndex = index;

let song = playlists[list][index];
let clean = song.replace(".mp3","");

let displayName = clean;
if(clean === "Harishankar ku irukka") displayName = "Harishankar ku irukka?";
if(clean === "Bomb") displayName = "Bomb (Endhu 1cm)";
if(clean === "Sanjai") displayName = "Sanjai's room (Endhu 1cm)";
if(clean === "Flute anthem") displayName = "Flute anthem(LOT-III)";
if(clean === "Jishnu Anthem Thalapathy Vijay vocal") displayName = "Jishnu Anthem Thalapathy Vijay Vocal";
if(clean === "LOT-III teaser concert") displayName = "LOT-III teaser concert(LOT-III)";

// üÜï Increment view will now work for ALL songs played
incrementView(displayName); 

let artist = getArtist(displayName) || getArtist(clean);
let color = getColor(displayName) || getColor(clean);

audio.src = song;
let playPromise = audio.play();
if (playPromise !== undefined) {
playPromise.then(_ => startVisuals()).catch(e => { console.error(e); stopVisuals(); });
}

document.getElementById("seekContainer").style.display = "flex";

showPopup(displayName, artist, list);
applySongTheme(color);
animatePlayButton();
}

function togglePlay(){
if(!audio.src) return;¬†
if(audio.paused){ audio.play().then(()=>startVisuals()); }
else { audio.pause(); stopVisuals(); }
animatePlayButton();
toggleWave();
}

function prevSong(){
if(!currentList || playlists[currentList].length === 0) return;
if(currentList === 'list4' || currentList === 'list1') return;¬†

currentIndex = (currentIndex - 1 + playlists[currentList].length) % playlists[currentList].length;
playSong(currentList, currentIndex);
}

function nextSong(){
if(!currentList || playlists[currentList].length === 0) return;
if(currentList === 'list4' || currentList === 'list1') return;

currentIndex = (currentIndex + 1) % playlists[currentList].length;
playSong(currentList, currentIndex);
}

/* POPUP CLOSE FUNCTION */
function closePopup() {
document.getElementById("popup").style.display = "none";
audio.pause();
stopVisuals();
animatePlayButton();
toggleWave();¬†
}

/* VISUALS */
function startVisuals() { document.body.classList.add("pulsing"); }
function stopVisuals() { document.body.classList.remove("pulsing"); }

function applySongTheme(color){
document.documentElement.style.setProperty('--song-color', color);
document.body.style.background = `radial-gradient(circle at center, ${color}22 0%, #0a0f2e 100%)`;
document.querySelectorAll("#soundwave div").forEach(w => w.style.background = color);
document.querySelector(".player").style.borderColor = color;
}

function showPopup(songName, artist, list){
let popup = document.getElementById("popup");
popup.style.display = "block";
document.getElementById("popupSongName").innerHTML = `<span>${songName} ‚Äî ${artist}</span>`;

let img = document.getElementById("popupImg");
img.style.display="block";

if(list === "list1" || list === "list4") {
img.src = "Poster.jpg";
}
else if(list === "list2") {
img.src = "Poster2.jpeg";
}
else if(list === "list3") {
if(songName.includes("Bomb") || songName.includes("Sanjai")) {
img.src = "poster4.png";¬†
}¬†
else if (songName.includes("Harishankar")) {
img.src = "Poster3.jpeg";¬†
}
else if (songName.includes("Happy Birthday")) {
img.src = "poster3.png";¬†
}
else {
img.src = "Poster3.jpeg";
}
}
else {
img.src = "Poster.jpg";
}

toggleWave();
}

function animatePlayButton(){
let icon = document.getElementById("playPauseIcon");
icon.innerText = audio.paused ? "‚ñ∂" : "‚è∏";
icon.style.marginLeft = audio.paused ? "2px" : "0px";
}

function toggleWave(){
let wave = document.getElementById("soundwave");
if(audio.paused) wave.classList.add("paused");
else wave.classList.remove("paused");
}

function formatTime(s) {
if(isNaN(s)) return "0:00";
let min = Math.floor(s / 60);
let sec = Math.floor(s % 60);
if(sec < 10) sec = "0" + sec;
return min + ":" + sec;
}
</script>
</body>
</html>





