<!DOCTYPE html>
<html lang="en">
<head>
<link rel="manifest" href="manifest.json">
<meta charset="UTF-8">
<title>Vibe with Jishnu</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0f2e">Â 

<style>
/* CORE LAYOUT */
body {
    margin: 0;
    background: #0a0f2e; /* Deep navy base */
    color: white;
    font-family: 'Segoe UI', sans-serif;
    overflow-x: hidden;
    min-height: 100vh;
    /* This creates the violet glow from the center */
    background: radial-gradient(circle at center, var(--song-color, #6a5bff)22 0%, #0a0f2e 100%);
}

/* THE BEATING HEART PULSE */
#bass-bg {
    position: fixed;
    top: 50%;
    left: 50%;
    width: 100vw;
    height: 100vw;
    transform: translate(-50%, -50%);
    background: radial-gradient(circle, var(--song-color, #6a5bff) 0%, transparent 70%);
    opacity: 0;
    z-index: -1;
    pointer-events: none;
}

.pulsing #bass-bg {
    animation: heartbeat 0.6s infinite;
}

@keyframes heartbeat {
    0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.3; }
    50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.5; }
    100% { transform: translate(-50%, -50%) scale(1.4); opacity: 0; }
}

/* PLAYER BAR FIXED AT BOTTOM */
.player {
    position: fixed;
    bottom: 0;
    width: 100%;
    background: rgba(10, 5, 30, 0.95);
    backdrop-filter: blur(10px);
    padding: 15px 0 35px;
    border-top: 2px solid var(--song-color, #6a5bff);
    z-index: 100;
}

/* PLAYLIST & TRENDING STYLES */
.playlistContainer { width: 90%; max-width: 700px; margin: 15px auto; background: rgba(255,255,255,0.05); border-radius: 12px; padding: 15px; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); }
.songList { display: none; margin-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); }
.trendingList { display: flex; overflow-x: auto; gap: 15px; padding: 10px; list-style: none; }
.trendingItem { flex: 0 0 150px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; }
.trendingCover { width: 100%; height: 120px; object-fit: cover; border-radius: 6px; }
</style>
</head>
<body class="">
Â  Â Â 

<div id="bass-bg"></div>

<header>
<img src="logo.png" alt="Logo" onerror="this.style.display='none'">
<h1>Vibe with Jishnu</h1>
</header>

<div class="trailer-banner">
Â  Â  <img src="tp.jpg" alt="LOT-III Trailer">
Â  Â  <div class="banner-caption">
Â  Â  Â  Â  <span>LOT-III Trailer out now!!</span>
Â  Â  </div>
</div>
Â  Â Â 
<a href="https://drive.google.com/file/d/1sl3XzH4e5rl8wIvRxTHvxDzpU0vTlZPv/view?usp=drivesdk" target="_blank" class="trailer-link-box">

Â  Â  <div class="trailer-text"><span>â–¶</span> LOT-III OFFICIAL TRAILER</div>

</a>
<div id="countdown-container">
Â  Â  <div class="countdown-title">LOT-III Release In</div>
Â  Â  <div id="countdown">00:00:00:00</div>
Â  Â  <div class="label-container">
Â  Â  Â  Â  <span>Days</span>
Â  Â  Â  Â  <span>Hrs</span>
Â  Â  Â  Â  <span>Min</span>
Â  Â  Â  Â  <span>Sec</span>
Â  Â  </div>
</div>


<div class="playlistContainer new-release">
Â  Â  <div class="playlistHeader" onclick="toggleList('list1')">
Â  Â  Â  Â  <span class="new-badge">NEW!!</span>
Â  Â  Â  Â  <img src="Poster.jpg" alt="LOT-III" onerror="this.src='https://via.placeholder.com/80/6a5bff/fff?text=Music'">
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <div class="playlistTitle">LOT-III OST</div>
Â  Â  Â  Â  Â  Â  <div style="font-size:12px; opacity:0.6">Original Sound Track</div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div id="list1" class="songList"></div>
</div>

<div class="playlistContainer new-release">
Â  Â  <div class="playlistHeader" onclick="toggleList('list4')">
Â  Â  Â  Â  <span class="new-badge">NEW!!</span>
Â  Â  Â  Â  <img src="Poster.jpg" alt="LOT-III Singles" onerror="this.src='https://via.placeholder.com/80/6a5bff/fff?text=Music'">
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <div class="playlistTitle">LOT-III Singles</div>
Â  Â  Â  Â  Â  Â  <div style="font-size:12px; opacity:0.6">Latest Releases</div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div id="list4" class="songList"></div>
</div>

<div class="playlistContainer">
Â  Â  <div class="playlistHeader" onclick="toggleList('list2')">
Â  Â  Â  Â  <img src="Poster2.jpeg" alt="50 Shades" onerror="this.src='https://via.placeholder.com/80/6a5bff/fff?text=Music'">
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <div class="playlistTitle">50 Shades of Jishnu Anthem</div>
Â  Â  Â  Â  Â  Â  <div style="font-size:12px; opacity:0.6">Song of the century</div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div id="list2" class="songList"></div>
</div>

<div class="playlistContainer">
Â  Â  <div class="playlistHeader" onclick="toggleList('list3')">
Â  Â  Â  Â  <img src="Poster3.jpeg" alt="Hits" onerror="this.src='https://via.placeholder.com/80/6a5bff/fff?text=Music'">
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <div class="playlistTitle">Blockbuster Hits</div>
Â  Â  Â  Â  Â  Â  <div style="font-size:12px; opacity:0.6">Fan Favorites</div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div id="list3" class="songList"></div>
</div>

<div class="trendingSection">
<h2>Trending Songs ğŸ”¥</h2>
<ul class="trendingList" id="trendingList">
</ul>
</div>
</div>

<div id="popup">
<button id="closePopupBtn" onclick="closePopup()">Ã—</button>

<img id="popupImg" src="" onerror="this.style.display='none'">
<div id="popupSongName"></div>
<div class="soundwave" id="soundwave">
<div></div><div></div><div></div><div></div><div></div>
</div>
</div>
<br><br><br><br><br><br><br><br><br><br>
<div class="player">
<div class="controls-row">
<button class="control" onclick="prevSong()">â®</button>
<button class="control" onclick="togglePlay()">
<span id="playPauseIcon" style="margin-left:2px;">â–¶</span>
</button>
<button class="control" onclick="nextSong()">â­</button>
</div>

<div class="seek-container" id="seekContainer">
<span id="currTimeText">0:00</span>
<input type="range" id="seekSlider" min="0" max="100" value="0">
<span id="durTimeText">0:00</span>
</div>
</div>

<audio id="audio"></audio>

<script type="module">
    // --- FIREBASE INITIALIZATION (Fixed Duplicate Imports) ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDohsquOam8YQXz7tqrWOG5f4pcXh-CnBM",
        authDomain: "weapon-fanpage.firebaseapp.com",
        projectId: "weapon-fanpage",
        storageBucket: "weapon-fanpage.firebasestorage.app",
        messagingSenderId: "124549409527",
        appId: "1:124549409527:web:85657a1d41c8950f7601f2"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Share Firebase functions globally for the standard script below
    window.db = db;
    window.doc = doc;
    window.updateDoc = updateDoc;
    window.getDoc = getDoc;

    // --- COUNTDOWN LOGIC ---
    function updateCountdown() {
        const now = new Date();
        const targetDate = new Date(`Jan 21, 2026 00:00:00`).getTime();
        const expiryDate = new Date(`Jan 22, 2026 00:00:00`).getTime();
        const currentTime = now.getTime();
        const distance = targetDate - currentTime;
        const container = document.getElementById("countdown-container");

        if (currentTime >= expiryDate) {
            if(container) container.style.display = "none";
            return; 
        }

        if (distance <= 0) {
            const cd = document.getElementById("countdown");
            if(cd) {
                cd.innerHTML = "Happy Birthday Jishnu";
                cd.style.fontSize = "1.8rem";
            }
            const label = document.querySelector(".label-container");
            if(label) label.style.display = "none";
            return;
        }

        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);
        const format = (num) => num.toString().padStart(2, '0');

        const cdBox = document.getElementById("countdown");
        if(cdBox) cdBox.innerHTML = `${days}:${format(hours)}:${format(minutes)}:${format(seconds)}`;
    }

    setInterval(updateCountdown, 1000);
    updateCountdown();
</script>

<script>
/* 1. DEFINE DATA FIRST */
const artists = {
    "Intermission(LOT-III)": "Jishnu, G.R.Adhavh",
    "Saavachuruven unna(LOT-III)": "Jishnu, G.R.Adhavh, Sanjai",
    "Sivagasi's Daaha(LOT-III)": "G.R.Adhavh, Shreyas",
    "Sivagasi's Dahaa x Saavachuruven unna(LOT-III)": "G.R.Adhavh, Shreyas, Jishnu",
    "The namechange(LOT-III)": "Kavinraaj, G.R.Adhavh",
    "Flute anthem(LOT-III)": "G.R.Adhavh",
    "Item number 1(LOT-III)": "G.R.Adhavh",
    "Saavadi Saravedi(LOT-III)": "Kavinraaj, G.R.Adhavh",
    "Anugundu Abhishek(LOT-III)": "G.R.Adhavh",
    "DSK on the move(LOT-III)": "G.R.Adhavh",
    "Hyper Harishankar(LOT-III)": "G.R.Adhavh",
    "Jishnu Anthem Reprise(LOT-III)": "G.R.Adhavh",
    "The fight(LOT-III)": "G.R.Adhavh",
    "King in the universe(LOT-III)": "G.R.Adhavh",
    "King vs Harold(LOT-III)": "G.R.Adhavh",
    "LOT-III teaser concert(LOT-III)": "G.R.Adhavh",
    "LOT-III Theme(LOT-III)": "G.R.Adhavh",
    "Vadakku Sadhuram il Jishnu(LOT-III)": "G.R.Adhavh",
    "default": "G.R.Adhavh"
};

const songAnimations = {
    "Intermission(LOT-III)": "#ff4d6d",
    "Saavachuruven unna(LOT-III)": "#4dd6ff",
    "Sivagasi's Daaha(LOT-III)": "#ffa600",
    "The namechange(LOT-III)": "#bb6bff",
    "Flute anthem(LOT-III)": "#00ffbf",
    "Item number 1(LOT-III)": "#ffd700",      
    "Saavadi Saravedi(LOT-III)": "#ff4500", 
    "Jishnu Anthem": "#00ff88",
    "default": "#6a5bff"
};

const playlists = {
    list1: [
        "Anugundu Abhishek.mp3", "DSK on the move.mp3", "Hyper Harishankar.mp3",
        "Intermission.mp3", "Jishnu Anthem Reprise.mp3", "The fight.mp3",
        "King in the Universe.mp3", "King vs Harold.mp3", "LOT-III teaser concert.mp3",
        "LOT-III Theme.mp3", "Saavachuruven unna.mp3", "Sivagasi's Daaha.mp3",
        "Sivagasis Daaha x Saavachuruven unna.mp3",
        "The namechange.mp3", "Vadakku Sadhuram il Jishnu.mp3", "Flute anthem.mp3"
    ],
    list4: [ "Item number 1.mp3", "Saavadi Saravedi.mp3" ],
    list2: [ "Jishnu Anthem.mp3", "Jishnu anthem Thalapathy Vijay vocal.mp3", "Jishnu Anthem slowed and reverbed.mp3", "Jishnu Anthem Karoke.mp3" ],
    list3: [ "Harishankar ku irukka.mp3", "Happy Birthday Megharajan.mp3", "Bomb.mp3", "Sanjai.mp3" ]
};

/* 2. DEFINE UTILITIES */
let currentList = "list1";
let currentIndex = 0;

function simplifyDisplayName(displayName) {
    return displayName.replace(/[()]/g, '').replace(/[^a-zA-Z0-9]/g, '');
}

function formatViews(num) {
    if (num === undefined) return "0 views";
    if (num >= 1000) return (num / 1000).toFixed(1) + 'K views';
    return num + ' views';
}

/* 3. DEFINE PLAYER FUNCTIONS */
function applySongTheme(color){
    // This pushes the color to the CSS --song-color variable used by #bass-bg
    document.documentElement.style.setProperty('--song-color', color);
    
    // This creates the soft violet radial glow in the background center
    document.body.style.background = `radial-gradient(circle at center, ${color}33 0%, #0a0f2e 100%)`;
    
    // Updates the player's top border to match the song's "vibe"
    const player = document.querySelector(".player");
    if(player) player.style.borderColor = color;
}

function showPopup(name, artist, list) {
    document.getElementById("popup").style.display = "block";
    document.getElementById("popupSongName").innerHTML = `<span>${name} â€” ${artist}</span>`;
    let img = document.getElementById("popupImg");
    if (list === 'list1' || list === 'list4') img.src = "Poster.jpg";
    else if (list === 'list2') img.src = "Poster2.jpeg";
    else {
        if (name.includes("Bomb") || name.includes("Sanjai")) img.src = "poster4.png";
        else if (name.includes("Harishankar")) img.src = "Poster3.jpeg";
        else if (name.includes("Happy Birthday")) img.src = "poster3.png";
        else img.src = "Poster3.jpeg";
    }
}

function playSong(list, index) {
    currentList = list;
    currentIndex = index;
    const fileName = playlists[list][index];
    const audio = document.getElementById("audio");
    audio.src = fileName;
    audio.play();

    let clean = fileName.replace(".mp3", "");
    let displayName = clean;
    if (list === 'list1' || list === 'list4') {
        if (clean === "Sivagasis Daaha x Saavachuruven unna") displayName = "Sivagasi's Dahaa x Saavachuruven unna(LOT-III)";
        else if (clean === "Sivagasi's Daaha") displayName = "Sivagasi's Daaha(LOT-III)";
        else displayName = clean + "(LOT-III)";
    }

    document.getElementById("playPauseIcon").innerText = "â¸";
    document.getElementById("seekContainer").style.display = "flex";
    document.body.classList.add("pulsing");
    
    incrementView(displayName);
    showPopup(displayName, artists[displayName] || "G.R.Adhavh", list);
    applySongTheme(songAnimations[displayName] || "#6a5bff");
}

/* 4. TRENDING LOGIC (Using defined data and functions) */
const allSongsForTrending = Object.keys(artists).filter(key => key !== 'default').map(displayName => {
    let cover = "Poster.jpg";
    if (displayName.includes("Jishnu Anthem")) cover = "Poster2.jpeg";
    if (displayName.includes("Bomb") || displayName.includes("Sanjai")) cover = "poster4.png";
    if (displayName.includes("Harishankar")) cover = "Poster3.jpeg";
    if (displayName.includes("Happy Birthday")) cover = "poster3.png";
    return { name: displayName, dbName: simplifyDisplayName(displayName), cover: cover };
});

function renderTrendingUI(viewsMap) {
    const listElem = document.getElementById("trendingList");
    if (!listElem) return;
    listElem.innerHTML = ''; 
    
    const sortedTrending = allSongsForTrending.slice().sort((a, b) => (viewsMap[b.dbName] || 0) - (viewsMap[a.dbName] || 0));
    
    sortedTrending.slice(0, 3).forEach((song, idx) => {
        const item = document.createElement("li");
        item.className = "trendingItem";
        
        // This ensures the image used in the Trending UI matches the song
        let coverImg = "Poster.jpg"; // Default
        if (song.name.includes("Anthem")) coverImg = "Poster2.jpeg";
        if (song.name.includes("Harishankar") || song.name.includes("Megharajan")) coverImg = "Poster3.jpeg";
        if (song.name.includes("Bomb") || song.name.includes("Sanjai")) coverImg = "poster4.png";

        item.innerHTML = `
            <div class="trendingRank">#${idx + 1}</div>
            <img class="trendingCover" src="${coverImg}" alt="${song.name}" onerror="this.src='https://via.placeholder.com/150/6a5bff/fff?text=Music'">
            <div class="trendingInfo">
                <div class="trendingTitle">${song.name}</div>
                <div class="trendingViews">${artists[song.name] || "G.R.Adhavh"} â€¢ ${formatViews(viewsMap[song.dbName])}</div>
            </div>
        `;
        
        // Find playlist ID to allow playing from trending click
        let playlistId = null, playlistIndex = -1;
        for (const lid in playlists) {
            playlistIndex = playlists[lid].findIndex(f => {
                let c = f.replace(".mp3", "");
                if (lid === 'list1' || lid === 'list4') c += "(LOT-III)";
                return c === song.name;
            });
            if (playlistIndex !== -1) { playlistId = lid; break; }
        }
        
        item.onclick = () => { if (playlistId) playSong(playlistId, playlistIndex); };
        listElem.appendChild(item);
    });
}

/* 5. REST OF THE UI & FIREBASE CODE */
function toggleList(id) {
    const el = document.getElementById(id);
    const isVisible = el.style.display === "block";
    document.querySelectorAll('.songList').forEach(l => l.style.display = "none");
    el.style.display = isVisible ? "none" : "block";
}

function setupPlaylists() {
    for (let id in playlists) {
        let listElem = document.getElementById(id);
        if (!listElem) continue;
        playlists[id].forEach((fileName, idx) => {
            let clean = fileName.replace(".mp3", "");
            let displayName = clean;
            if (id === 'list1' || id === 'list4') {
                if (clean === "Sivagasis Daaha x Saavachuruven unna") displayName = "Sivagasi's Dahaa x Saavachuruven unna(LOT-III)";
                else if (clean === "Sivagasi's Daaha") displayName = "Sivagasi's Daaha(LOT-III)";
                else displayName = clean + "(LOT-III)";
            }
            let div = document.createElement("div");
            div.className = "track";
            if (id === 'list1' || id === 'list4') div.classList.add("playable-new");
            div.innerHTML = `<div><strong>${displayName}</strong><br><span>${artists[displayName] || "G.R.Adhavh"}</span></div><span>â–¶</span>`;
            div.onclick = () => playSong(id, idx);
            listElem.appendChild(div);
        });
    }
}

async function incrementView(displayName) {
    if (!window.db) return;
    const dbName = simplifyDisplayName(displayName);
    const docRef = window.doc(window.db, "all_songs_views", "all_song_data");
    try {
        const docSnap = await window.getDoc(docRef);
        if (docSnap.exists()) {
            const data = docSnap.data();
            const viewsMap = data.views_map || {};
            viewsMap[dbName] = (viewsMap[dbName] || 0) + 1;
            await window.updateDoc(docRef, { views_map: viewsMap });
            renderTrendingUI(viewsMap);
        }
    } catch (e) { console.error(e); }
}

async function fetchAndRenderTrending() {
    if (!window.db) { setTimeout(fetchAndRenderTrending, 100); return; }
    try {
        const docRef = window.doc(window.db, "all_songs_views", "all_song_data");
        const docSnap = await window.getDoc(docRef);
        if (docSnap.exists()) renderTrendingUI(docSnap.data().views_map || {});
    } catch (e) { console.error(e); }
}

/* PLAYER CONTROLS & EVENT LISTENERS */

function togglePlay() {
    const audio = document.getElementById("audio");
    const icon = document.getElementById("playPauseIcon");
    if (!audio.src) return;

    if (audio.paused) {
        audio.play();
        icon.innerText = "â¸";
        document.body.classList.add("pulsing");
    } else {
        audio.pause();
        icon.innerText = "â–¶";
        document.body.classList.remove("pulsing");
    }
}

function nextSong() {
    if (!currentList) return;
    currentIndex = (currentIndex + 1) % playlists[currentList].length;
    playSong(currentList, currentIndex);
}

function prevSong() {
    if (!currentList) return;
    currentIndex = (currentIndex - 1 + playlists[currentList].length) % playlists[currentList].length;
    playSong(currentList, currentIndex);
}

function closePopup() {
    document.getElementById("popup").style.display = "none";
}

/* AUDIO ELEMENT LOGIC */
const audio = document.getElementById("audio");
const seekSlider = document.getElementById("seekSlider");

// Update progress bar as song plays
audio.addEventListener('timeupdate', () => {
    if (audio.duration) {
        const pct = (audio.currentTime / audio.duration) * 100;
        seekSlider.value = pct;
        document.getElementById("currTimeText").innerText = formatTime(audio.currentTime);
        document.getElementById("durTimeText").innerText = formatTime(audio.duration);
    }
});

// Seek song when slider is moved
seekSlider.addEventListener('input', () => {
    if (audio.duration) {
        audio.currentTime = (seekSlider.value / 100) * audio.duration;
    }
});

// Auto-play next song when current one ends
audio.addEventListener('ended', nextSong);

function formatTime(s) {
    if(isNaN(s)) return "0:00";
    let m = Math.floor(s/60), sec = Math.floor(s%60);
    return m + ":" + (sec < 10 ? "0" + sec : sec);
}

window.onload = () => {
    setupPlaylists();
    fetchAndRenderTrending();
};
</script>
</body>
</html>





